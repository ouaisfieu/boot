<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Oracle Pile / Face · Jeu énigmatique</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --bg: #050616;
      --card: #0b0f24;
      --card-soft: #11152f;
      --border: rgba(255,255,255,0.16);
      --accent-pile: #3dffb5;
      --accent-face: #ff6bd8;
      --accent-edge: #ffdd57;
      --text: #f7f7ff;
      --muted: #a3a3d5;
      --shadow: 0 18px 40px rgba(0,0,0,0.9);
      --radius-lg: 18px;
      --radius-md: 14px;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #262763 0, #050616 55%),
        radial-gradient(circle at bottom, #170924 0, #050616 60%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.8rem;
    }
    .shell {
      width: 100%;
      max-width: 720px;
    }
    .frame {
      background: radial-gradient(circle at top left, rgba(255,255,255,0.06), rgba(0,0,0,0.96));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: var(--shadow);
      padding: 0.9rem 0.9rem 0.85rem;
      position: relative;
      overflow: hidden;
    }
    .grain {
      position: absolute;
      inset: -10%;
      pointer-events: none;
      opacity: 0.25;
      background-image:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, transparent 1px, transparent 3px),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.6) 0, rgba(0,0,0,0.6) 1px, transparent 1px, transparent 3px);
      mix-blend-mode: soft-light;
    }
    .content {
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 0.8rem;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 0.6rem;
    }
    .title-block {
      max-width: 420px;
    }
    h1 {
      font-size: 1.05rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent-edge);
      text-shadow: 0 0 10px rgba(255,221,87,0.8);
    }
    .subtitle {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.25rem;
      line-height: 1.5;
    }
    .badge {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.35);
      padding: 0.28rem 0.9rem;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: radial-gradient(circle at top, rgba(255,255,255,0.08), rgba(0,0,0,1));
      white-space: nowrap;
    }
    .badge-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--accent-pile);
      box-shadow: 0 0 12px rgba(61,255,181,0.9);
    }

    /* Stepper / barre de progression */
    .stepper {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 0.45rem;
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
      flex-wrap: wrap;
    }
    .progress-bar {
      margin-top: 0.25rem;
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent-pile), var(--accent-edge), var(--accent-face));
      box-shadow: 0 0 14px rgba(255,255,255,0.6);
      transition: width 0.25s ease-out;
    }

    /* Card question / écran */
    .card {
      background: radial-gradient(circle at top left, rgba(255,255,255,0.04), var(--card));
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      padding: 0.7rem 0.7rem 0.65rem;
      box-shadow: 0 10px 24px rgba(0,0,0,0.9);
      margin-bottom: 0.5rem;
    }
    .card-title {
      font-size: 0.86rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 0.3rem;
    }
    .card-subtitle {
      font-size: 0.76rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
      line-height: 1.5;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-bottom: 0.35rem;
    }

    .option {
      position: relative;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      padding: 0.4rem 0.75rem 0.4rem 0.9rem;
      font-size: 0.78rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
      background: radial-gradient(circle at top, rgba(255,255,255,0.06), rgba(0,0,0,1));
      color: var(--text);
      cursor: pointer;
      transition: transform 0.06s ease-out, box-shadow 0.08s ease-out, border-color 0.08s ease-out, background 0.08s ease-out;
    }
    .option-key {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.68rem;
      opacity: 0.85;
      flex-shrink: 0;
    }
    .option-label-main {
      font-weight: 600;
    }
    .option-label-sub {
      font-size: 0.7rem;
      color: var(--muted);
    }
    .option:hover {
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.55);
      box-shadow: 0 0 14px rgba(255,255,255,0.35);
      background: radial-gradient(circle at top, rgba(255,255,255,0.11), rgba(0,0,0,1));
    }
    .option.selected {
      border-color: var(--accent-edge);
      box-shadow: 0 0 18px rgba(255,221,87,0.8);
      background: radial-gradient(circle at top, rgba(255,221,87,0.25), rgba(0,0,0,1));
    }

    .meta-line {
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Boutons navigation */
    .actions {
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
      margin-top: 0.4rem;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 0.32rem 0.9rem;
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      background: radial-gradient(circle at top, rgba(255,255,255,0.12), rgba(0,0,0,1));
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: transform 0.06s ease-out, box-shadow 0.08s ease-out, border-color 0.08s ease-out, background 0.08s ease-out;
    }
    .btn span.dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent-edge);
      box-shadow: 0 0 12px rgba(255,221,87,0.9);
    }
    .btn.secondary span.dot {
      background: var(--muted);
      box-shadow: 0 0 10px rgba(163,163,213,0.8);
    }
    .btn.primary span.dot {
      background: var(--accent-pile);
      box-shadow: 0 0 12px rgba(61,255,181,0.9);
    }
    .btn.danger span.dot {
      background: var(--accent-face);
      box-shadow: 0 0 12px rgba(255,107,216,0.9);
    }
    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.7);
      box-shadow: 0 0 16px rgba(255,255,255,0.6);
      background: radial-gradient(circle at top, rgba(255,255,255,0.2), rgba(0,0,0,1));
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,1);
    }
    .btn[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    /* Écran final */
    .result-header {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-bottom: 0.45rem;
    }
    .result-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 999px;
      padding: 0.24rem 0.7rem;
      font-size: 0.68rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      border: 1px solid rgba(255,255,255,0.35);
    }
    .result-pill span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      box-shadow: 0 0 10px currentColor;
    }
    .result-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }
    .result-sub {
      font-size: 0.76rem;
      color: var(--muted);
      line-height: 1.5;
    }
    .result-grid {
      display: grid;
      grid-template-columns: minmax(0,1.2fr) minmax(0,1.1fr);
      gap: 0.65rem;
      margin-top: 0.4rem;
    }
    @media (max-width: 640px) {
      .result-grid {
        grid-template-columns: minmax(0,1fr);
      }
    }
    .result-block {
      background: radial-gradient(circle at top left, rgba(255,255,255,0.03), var(--card-soft));
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 0.5rem 0.6rem;
      font-size: 0.75rem;
      line-height: 1.55;
    }
    .result-block h3 {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 0.25rem;
    }
    .result-tags {
      margin-top: 0.25rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      font-size: 0.68rem;
    }
    .tag {
      border-radius: 999px;
      padding: 0.1rem 0.55rem;
      border: 1px solid rgba(255,255,255,0.28);
      background: rgba(0,0,0,0.5);
    }
    .links-list {
      list-style: none;
      margin: 0.25rem 0 0;
      padding: 0;
      font-size: 0.73rem;
    }
    .links-list li + li {
      margin-top: 0.18rem;
    }
    .links-list a {
      color: var(--accent-pile);
      text-decoration: none;
    }
    .links-list a:hover {
      text-decoration: underline;
    }
    .scores-raw {
      margin-top: 0.25rem;
      font-size: 0.68rem;
      color: var(--muted);
    }

    footer {
      margin-top: 0.4rem;
      font-size: 0.68rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="frame">
    <div class="grain"></div>
    <div class="content">
      <header>
        <div class="title-block">
          <h1>ORACLE PILE / FACE</h1>
          <p class="subtitle">
            Tu ne sais pas ce que signifie rejoindre le côté <strong>Pile</strong> ou <strong>Face</strong>.  
            Ce jeu non plus. Mais il va quand même décider dans quel camp tu tombes,  
            et quel genre de pièce tu es.
          </p>
        </div>
        <div class="badge">
          <span class="badge-dot"></span>
          TEST PROJECTIF · 9 ARCHÉTYPES
        </div>
      </header>

      <section class="stepper">
        <span id="step-label">ÉTAPE 0 · CHOISIR DE JOUER</span>
        <span id="side-hint">Côté indéterminé</span>
        <div class="progress-bar">
          <div class="progress-inner" id="progress-inner"></div>
        </div>
      </section>

      <!-- Carte dynamique -->
      <section class="card" id="card">
        <!-- Contenu injecté en JS -->
      </section>

      <section class="actions" id="nav-actions">
        <button class="btn secondary" id="btn-back">
          <span class="dot"></span>
          Revenir
        </button>
        <div style="display:flex;gap:0.35rem;flex-wrap:wrap;">
          <button class="btn danger" id="btn-reset">
            <span class="dot"></span>
            Tout effacer
          </button>
          <button class="btn primary" id="btn-next">
            <span class="dot"></span>
            Suivant
          </button>
        </div>
      </section>

      <footer>
        <span>Les questions sont volontairement opaques. Tu n’es pas censé tout comprendre.</span>
        <span>À la fin : un bilan personnel et une sélection de liens selon ton archetype.</span>
      </footer>
    </div>
  </div>
</div>

<script>
  // --- Données du jeu ---

  const QUESTIONS = [
    {
      id: 1,
      title: "Pré-lancer la pièce",
      subtitle: "On te tend une pièce mystérieuse. On ne te dit pas à quoi elle sert. Tu as juste le poids en main.",
      options: [
        {
          key: "A",
          label: "Je la tourne entre mes doigts en silence.",
          sub: "Je veux voir comment elle réagit à la lumière.",
          scores: { pile: 1, face: 0, edge: 1, joueur: 0, archiviste: 1, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je la lance tout de suite, juste pour voir.",
          sub: "Ce qui tombe dira plus que le métal.",
          scores: { pile: 0, face: 1, edge: 0, joueur: 1, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je la pose sur la tranche sur la table.",
          sub: "Si elle tient, c’est qu’il y a un troisième choix.",
          scores: { pile: 0, face: 0, edge: 2, joueur: 0, archiviste: 0, guerrier: 1 }
        }
      ]
    },
    {
      id: 2,
      title: "Instruction floue",
      subtitle: "On te dit juste : « Ne fais pas comme tout le monde. » Mais personne ne précise ce que fait « tout le monde ».",
      options: [
        {
          key: "A",
          label: "Je demande un exemple concret.",
          sub: "Sans cadre, je me méfie des injonctions.",
          scores: { pile: 1, face: 0, edge: 0, joueur: 0, archiviste: 2, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je fais l’inverse de mon premier réflexe.",
          sub: "Au moins, je casse un automatisme.",
          scores: { pile: 0, face: 1, edge: 0, joueur: 1, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je ne bouge pas. L’inaction est aussi un choix.",
          sub: "Je regarde qui s’agite autour.",
          scores: { pile: 0, face: 0, edge: 1, joueur: 0, archiviste: 0, guerrier: 1 }
        }
      ]
    },
    {
      id: 3,
      title: "La salle aux deux portes",
      subtitle: "Devant toi, deux portes identiques. On murmure « Pile » derrière l’une, « Face » derrière l’autre. Rien d’autre.",
      options: [
        {
          key: "A",
          label: "Je colle mon oreille contre chaque porte.",
          sub: "Les sons parasites m’intéressent plus que les mots.",
          scores: { pile: 1, face: 0, edge: 1, joueur: 0, archiviste: 1, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je choisis une porte au hasard et j’entre.",
          sub: "L’hésitation épuise plus que l’erreur.",
          scores: { pile: 0, face: 2, edge: 0, joueur: 1, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je cherche la trappe de service ou la fenêtre.",
          sub: "Si l’on me propose deux options, j’en invente une troisième.",
          scores: { pile: 0, face: 0, edge: 2, joueur: 0, archiviste: 0, guerrier: 1 }
        }
      ]
    },
    {
      id: 4,
      title: "Erreur dans le tirage",
      subtitle: "On te dit que la pièce est « probablement biaisée ». On te demande d’en tenir compte.",
      options: [
        {
          key: "A",
          label: "Je note chaque lancer dans un carnet.",
          sub: "Les biais, ça se mesure avant de se subir.",
          scores: { pile: 1, face: 0, edge: 0, joueur: 0, archiviste: 2, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je m’en moque, je joue quand même.",
          sub: "L’important, c’est le mouvement, pas les statistiques.",
          scores: { pile: 0, face: 2, edge: 0, joueur: 1, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je propose de changer de pièce, ou de jeu.",
          sub: "Si l’outil est tordu, je change l’outil.",
          scores: { pile: 0, face: 0, edge: 1, joueur: 0, archiviste: 0, guerrier: 2 }
        }
      ]
    },
    {
      id: 5,
      title: "Spectateurs",
      subtitle: "Un petit groupe t’observe pendant que tu décides. On ne sait pas ce qu’ils attendent de toi.",
      options: [
        {
          key: "A",
          label: "Je fais comme s’ils n’existaient pas.",
          sub: "Le vrai test n’est pas pour eux.",
          scores: { pile: 1, face: 0, edge: 0, joueur: 0, archiviste: 1, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je joue un rôle pour les troubler.",
          sub: "S’ils veulent un spectacle, je contrôle le scénario.",
          scores: { pile: 0, face: 1, edge: 0, joueur: 2, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je les interroge sur leur propre choix.",
          sub: "Un miroir vaut mieux qu’un public.",
          scores: { pile: 0, face: 0, edge: 1, joueur: 0, archiviste: 0, guerrier: 2 }
        }
      ]
    },
    {
      id: 6,
      title: "Après le lancer",
      subtitle: "La pièce retombe… hors de ton champ de vision. Les autres voient le résultat, pas toi.",
      options: [
        {
          key: "A",
          label: "Je demande ce qu’ils ont vu, chacun séparément.",
          sub: "La vérité est rarement un seul récit.",
          scores: { pile: 2, face: 0, edge: 0, joueur: 0, archiviste: 2, guerrier: 0 }
        },
        {
          key: "B",
          label: "Je déclare que le résultat m’importe peu.",
          sub: "Ce qui compte, c’est que j’ai accepté de jouer.",
          scores: { pile: 0, face: 2, edge: 0, joueur: 1, archiviste: 0, guerrier: 0 }
        },
        {
          key: "C",
          label: "Je relance la pièce, cette fois en regardant.",
          sub: "Si je dois assumer, je veux voir de mes propres yeux.",
          scores: { pile: 0, face: 0, edge: 2, joueur: 0, archiviste: 0, guerrier: 2 }
        }
      ]
    }
  ];

  // 9 archétypes (3 côtés x 3 styles)
  const ARCHETYPES = {
    "pile_joueur": {
      title: "Pile · Joueur souterrain",
      sideLabel: "Tu tombes du côté PILE",
      side: "pile",
      style: "joueur",
      summary: "Tu joues avec la structure tout en restant du côté de l’ombre. Tu acceptes les règles, mais tu les tournes à ton avantage dès que possible.",
      bilan: [
        "Tu avances souvent en testant les limites sans forcément les annoncer.",
        "Tu as un instinct pour sentir d’où viennent les décisions, même si elles sont cachées.",
        "Tu préfères les chemins discrets aux coups d’éclat spectaculaires."
      ],
      tags: ["Observation active", "Ruse tranquille", "Mouvements silencieux"],
      links: [
        { label: "Intro douce au jeu stratégique", url: "https://example.com/strategie-douce" },
        { label: "Dossiers à lire en sous-marin", url: "https://example.com/lecture-souterraine" },
        { label: "Portail Pile · Zone discrète", url: "https://example.com/pile-discret" }
      ]
    },
    "pile_archiviste": {
      title: "Pile · Architecte des preuves",
      sideLabel: "Tu tombes du côté PILE",
      side: "pile",
      style: "archiviste",
      summary: "Tu construis des archives, des cartes, des dossiers. Tu fais partie de celles et ceux qui savent où sont rangés les fils cachés.",
      bilan: [
        "Tu as besoin de traces, de notes, de journaux — pas pour le contrôle, mais pour la mémoire collective.",
        "Tu n’aimes pas les pièces truquées : tu préfères démonter publiquement le mécanisme.",
        "Tu es plus dangereux·se avec un classeur bien tenu qu’avec un mégaphone."
      ],
      tags: ["Cartographie", "Mémoire longue", "Veille silencieuse"],
      links: [
        { label: "Atelier ‘cartographier le réel’", url: "https://example.com/cartographie" },
        { label: "Méthodes de veille citoyenne", url: "https://example.com/veille" },
        { label: "Portail Pile · Archives vivantes", url: "https://example.com/pile-archives" }
      ]
    },
    "pile_guerrier": {
      title: "Pile · Stratège en retrait",
      sideLabel: "Tu tombes du côté PILE",
      side: "pile",
      style: "guerrier",
      summary: "Tu n’attaques pas en premier, mais tu réfléchis déjà à ce que tu feras après le premier choc.",
      bilan: [
        "Tu choisis tes batailles : tu sais que tout conflit consomme du temps, de l’énergie, des nerfs.",
        "Tu prends au sérieux les conditions matérielles avant de ‘lancer la pièce’.",
        "On te sous-estime souvent parce que tu prends ton temps."
      ],
      tags: ["Prudence armée", "Tactique", "Préparation"],
      links: [
        { label: "Guide d’autodéfense mentale", url: "https://example.com/autodefense" },
        { label: "Scénarios ‘et si ça tourne mal ?’", url: "https://example.com/scenarios" },
        { label: "Portail Pile · Plans B&C", url: "https://example.com/pile-plans" }
      ]
    },
    "face_joueur": {
      title: "Face · Cascadeur social",
      sideLabel: "Tu tombes du côté FACE",
      side: "face",
      style: "joueur",
      summary: "Tu joues la pièce comme un prétexte pour voir comment les autres réagissent. Le hasard est ton alibi.",
      bilan: [
        "Tu aimes tester les limites des situations en direct, quitte à improviser la suite.",
        "Tu es à l’aise avec l’idée d’échec public : tu sais que ça fait partie du jeu.",
        "Tu manipules volontiers les apparences, mais tu sais pourquoi."
      ],
      tags: ["Improvisation", "Scène ouverte", "Expérimentation"],
      links: [
        { label: "Atelier ‘théâtre d’essai social’", url: "https://example.com/theatre-social" },
        { label: "Jeux de rôle politiques low-tech", url: "https://example.com/jeux-role" },
        { label: "Portail Face · Expériences publiques", url: "https://example.com/face-exp" }
      ]
    },
    "face_archiviste": {
      title: "Face · Chroniqueur du chaos",
      sideLabel: "Tu tombes du côté FACE",
      side: "face",
      style: "archiviste",
      summary: "Tu documentes les jeux, les dérives, les biais, les angles morts. Tu fais des autopsies de pièces déjà tombées.",
      bilan: [
        "Tu observes les mises en scène collectives avec une certaine ironie tendre.",
        "Tu aimes autant l’échec que la victoire, tant que tu peux les raconter clairement.",
        "Tu es précieux·se pour garder la mémoire de ce qui s’est vraiment passé."
      ],
      tags: ["Récit", "Analyse à froid", "Post-mortem"],
      links: [
        { label: "Atelier ‘écrire l’envers des histoires’", url: "https://example.com/envers" },
        { label: "Guide : faire un bilan collectif", url: "https://example.com/bilan" },
        { label: "Portail Face · Chroniques", url: "https://example.com/face-chroniques" }
      ]
    },
    "face_guerrier": {
      title: "Face · Frontal·e par principe",
      sideLabel: "Tu tombes du côté FACE",
      side: "face",
      style: "guerrier",
      summary: "Tu n’aimes pas jouer en douce. S’il faut trancher, tu préfères que tout le monde entende la pièce frapper la table.",
      bilan: [
        "Tu assumes tes prises de position, même quand le décor n’est pas prêt.",
        "Tu refuses que la neutralité soit présentée comme le choix ‘raisonnable’.",
        "Tu préfères les lignes claires aux arrangements flous."
      ],
      tags: ["Clarté", "Affrontement assumé", "Décision"],
      links: [
        { label: "Kit ‘prendre la parole sans filtre’", url: "https://example.com/parole" },
        { label: "Tactiques de conflit non armé", url: "https://example.com/conflit" },
        { label: "Portail Face · Front ouvert", url: "https://example.com/face-front" }
      ]
    },
    "edge_joueur": {
      title: "Tranche · Funambule ludique",
      sideLabel: "Tu marches sur la tranche",
      side: "edge",
      style: "joueur",
      summary: "Tu refuses d’être rangé·e pile ou face, mais tu ne refuses pas le jeu. Tu l’étends jusqu’à ce que les règles craquent.",
      bilan: [
        "Tu as le don de transformer chaque test en laboratoire à ciel ouvert.",
        "Tu sais que les étiquettes rassurent plus qu’elles ne décrivent.",
        "Tu acceptes l’instabilité comme un matériau, pas comme une menace."
      ],
      tags: ["Ambivalence", "Détournement", "Créativité sous contrainte"],
      links: [
        { label: "Explorations à mi-chemin (ni pour, ni contre)", url: "https://example.com/milieu" },
        { label: "Jeux à règles mouvantes", url: "https://example.com/regles" },
        { label: "Portail Tranche · Zones grises", url: "https://example.com/tranche" }
      ]
    },
    "edge_archiviste": {
      title: "Tranche · Cartographe des zones grises",
      sideLabel: "Tu marches sur la tranche",
      side: "edge",
      style: "archiviste",
      summary: "Tu t’intéresses surtout à ce qui n’est ni clairement pile, ni clairement face. Tu dresses des cartes entre les cases.",
      bilan: [
        "Tu refuses les dichotomies trop propres : tu gribouilles les marges.",
        "Tu recueilles les versions contradictoires au lieu d’en choisir une seule.",
        "Tu es doué·e pour faire apparaître ce que tout le monde sent mais que personne ne formule."
      ],
      tags: ["Nuances", "Marge", "Interstices"],
      links: [
        { label: "Atlas des interzones", url: "https://example.com/atlas" },
        { label: "Méthodes pour nommer l’indicible", url: "https://example.com/indicible" },
        { label: "Portail Tranche · Cartes hybrides", url: "https://example.com/hybride" }
      ]
    },
    "edge_guerrier": {
      title: "Tranche · Saboteur de pièces",
      sideLabel: "Tu marches sur la tranche",
      side: "edge",
      style: "guerrier",
      summary: "Tu ne refuses pas le concept de pile et face : tu refuses la façon dont on s’en sert pour enfermer les gens.",
      bilan: [
        "Tu as un radar pour repérer qui impose les règles, et pourquoi.",
        "Tu n’hésites pas à changer de jeu quand le cadre est toxique.",
        "Tu es prêt·e à encaisser des malentendus pour ne pas te laisser coincer."
      ],
      tags: ["Refus actif", "Reconfiguration", "Conflit de cadres"],
      links: [
        { label: "Manuel de sabotage bienveillant", url: "https://example.com/sabotage" },
        { label: "Exercises pour sortir du binaire", url: "https://example.com/binaire" },
        { label: "Portail Tranche · Laboratoire de règles", url: "https://example.com/lab" }
      ]
    }
  };

  // --- État du jeu ---
  let currentStep = -1; // -1 = écran d’intro, 0..len-1 = questions, len = résultat
  const answers = new Array(QUESTIONS.length).fill(null);

  const cardEl = document.getElementById("card");
  const stepLabelEl = document.getElementById("step-label");
  const sideHintEl = document.getElementById("side-hint");
  const progressInnerEl = document.getElementById("progress-inner");
  const btnBack = document.getElementById("btn-back");
  const btnNext = document.getElementById("btn-next");
  const btnReset = document.getElementById("btn-reset");
  const navActionsEl = document.getElementById("nav-actions");

  // --- Utilitaires scores ---
  function computeScores() {
    let pile = 0, face = 0, edge = 0;
    let joueur = 0, archiviste = 0, guerrier = 0;

    answers.forEach((optionIndex, questionIndex) => {
      if (optionIndex === null) return;
      const opt = QUESTIONS[questionIndex].options[optionIndex];
      if (!opt || !opt.scores) return;
      pile += opt.scores.pile || 0;
      face += opt.scores.face || 0;
      edge += opt.scores.edge || 0;
      joueur += opt.scores.joueur || 0;
      archiviste += opt.scores.archiviste || 0;
      guerrier += opt.scores.guerrier || 0;
    });

    return { pile, face, edge, joueur, archiviste, guerrier };
  }

  function decideSide(scores) {
    const { pile, face, edge } = scores;
    const max = Math.max(pile, face, edge);
    const candidates = [];
    if (pile === max) candidates.push("pile");
    if (face === max) candidates.push("face");
    if (edge === max) candidates.push("edge");
    if (candidates.length === 1) return candidates[0];

    // égalité : la tranche gagne si elle fait partie du lot, sinon pile
    if (candidates.includes("edge")) return "edge";
    return "pile";
  }

  function decideStyle(scores) {
    const { joueur, archiviste, guerrier } = scores;
    const max = Math.max(joueur, archiviste, guerrier);
    const candidates = [];
    if (joueur === max) candidates.push("joueur");
    if (archiviste === max) candidates.push("archiviste");
    if (guerrier === max) candidates.push("guerrier");
    if (candidates.length === 1) return candidates[0];

    // tie-break: joueur > archiviste > guerrier
    if (candidates.includes("joueur")) return "joueur";
    if (candidates.includes("archiviste")) return "archiviste";
    return "guerrier";
  }

  function sideLabelPreview(scores) {
    const side = decideSide(scores);
    if (side === "pile") return "Gravité actuelle : PILE";
    if (side === "face") return "Gravité actuelle : FACE";
    return "Gravité actuelle : TRANCHÉE";
  }

  // --- Rendu des écrans ---

  function render() {
    const totalSteps = QUESTIONS.length;
    const scores = computeScores();

    if (currentStep === -1) {
      // écran d’intro
      stepLabelEl.textContent = "ÉTAPE 0 · TU AS LE DROIT DE REFUSER";
      sideHintEl.textContent = "Côté indéterminé";
      progressInnerEl.style.width = "0%";
      renderIntro();
      btnBack.disabled = true;
      btnNext.textContent = "Commencer";
      btnNext.removeAttribute("disabled");
      return;
    }

    if (currentStep >= 0 && currentStep < totalSteps) {
      const stepNumber = currentStep + 1;
      stepLabelEl.textContent = "ÉTAPE " + stepNumber + " / " + totalSteps;
      sideHintEl.textContent = sideLabelPreview(scores);
      const progress = ((stepNumber) / (totalSteps + 1)) * 100;
      progressInnerEl.style.width = progress + "%";

      renderQuestion(currentStep);
      btnBack.disabled = currentStep === -1;
      btnNext.textContent = (currentStep === totalSteps - 1) ? "Voir mon bilan" : "Suivant";
      // Empêcher d avancer sans répondre
      if (answers[currentStep] === null) {
        btnNext.setAttribute("disabled", "disabled");
      } else {
        btnNext.removeAttribute("disabled");
      }
      return;
    }

    // écran de résultat
    stepLabelEl.textContent = "BILAN FINAL · LANCER TERMINÉ";
    sideHintEl.textContent = sideLabelPreview(scores);
    progressInnerEl.style.width = "100%";
    renderResult(scores);
    btnBack.textContent = "Rejouer autrement";
    btnNext.textContent = "Relancer depuis zéro";
    btnNext.removeAttribute("disabled");
  }

  function renderIntro() {
    cardEl.innerHTML = `
      <div class="card-title">Avant de lancer la pièce</div>
      <p class="card-subtitle">
        Ce jeu ne va pas te demander si tu es « d’accord » avec quoi que ce soit.  
        Il ne te dira pas non plus ce que signifie vraiment rejoindre le côté <strong>Pile</strong> ou <strong>Face</strong>.
        <br><br>
        Il va juste observer <em>comment</em> tu réagis à quelques situations floues,  
        puis décider quel genre de pièce tu es, et où tu tombes le plus souvent.
      </p>
      <div class="options">
        <div class="option selected">
          <div class="option-key">?</div>
          <div>
            <div class="option-label-main">Je joue en sachant que tout est biaisé.</div>
            <div class="option-label-sub">Ce n’est pas un contrat. C’est un miroir déformant, assumé comme tel.</div>
          </div>
        </div>
      </div>
      <div class="meta-line">
        <span>Durée : 6 décisions énigmatiques.</span>
        <span>À la fin : 1 profil sur 9 + une liste de liens à explorer.</span>
      </div>
    `;
  }

  function renderQuestion(index) {
    const q = QUESTIONS[index];
    const already = answers[index];

    const optionsHtml = q.options.map((opt, i) => {
      const selected = already === i ? " selected" : "";
      return `
        <button class="option${selected}" data-index="${i}">
          <div class="option-key">${opt.key}</div>
          <div>
            <div class="option-label-main">${opt.label}</div>
            <div class="option-label-sub">${opt.sub}</div>
          </div>
        </button>
      `;
    }).join("");

    cardEl.innerHTML = `
      <div class="card-title">${q.title}</div>
      <p class="card-subtitle">${q.subtitle}</p>
      <div class="options">
        ${optionsHtml}
      </div>
      <div class="meta-line">
        <span>Question ${index + 1} / ${QUESTIONS.length}</span>
        <span>Choisis l’option qui te ressemble <em>aujourd’hui</em>, pas celle qui te flatterait.</span>
      </div>
    `;

    // Ajout des listeners sur les options
    cardEl.querySelectorAll(".option").forEach(btn => {
      btn.addEventListener("click", () => {
        const idx = parseInt(btn.dataset.index, 10);
        answers[index] = idx;
        // visuel sélection
        cardEl.querySelectorAll(".option").forEach(o => o.classList.remove("selected"));
        btn.classList.add("selected");
        btnNext.removeAttribute("disabled");
      });
    });
  }

  function renderResult(scores) {
    const side = decideSide(scores);
    const style = decideStyle(scores);
    const key = `${side}_${style}`;
    const data = ARCHETYPES[key] || ARCHETYPES["edge_archiviste"];

    const sideColor =
      side === "pile" ? "var(--accent-pile)" :
      side === "face" ? "var(--accent-face)" :
      "var(--accent-edge)";

    const styleLabel =
      style === "joueur" ? "Style : Joueur / mise en scène" :
      style === "archiviste" ? "Style : Archiviste / structure" :
      "Style : Guerrier·e / reconfiguration";

    const bilanHtml = data.bilan.map(line => `<li>${line}</li>`).join("");
    const tagsHtml = data.tags.map(tag => `<span class="tag">${tag}</span>`).join("");
    const linksHtml = data.links.map(l => `
      <li>• <a href="${l.url}" target="_blank" rel="noopener">${l.label}</a></li>
    `).join("");

    cardEl.innerHTML = `
      <div class="result-header">
        <div class="result-pill" style="border-color:${sideColor};color:${sideColor};">
          <span class="dot" style="background:${sideColor};"></span>
          ${data.sideLabel.toUpperCase()}
        </div>
        <div class="result-title">${data.title}</div>
        <div class="result-sub">
          ${data.summary}
        </div>
      </div>

      <div class="result-grid">
        <div class="result-block">
          <h3>Bilan personnel</h3>
          <p style="margin-bottom:0.25rem;font-size:0.72rem;color:${sideColor};">
            ${styleLabel}
          </p>
          <ul style="padding-left:1rem;margin:0;font-size:0.74rem;">
            ${bilanHtml}
          </ul>
          <div class="result-tags">
            ${tagsHtml}
          </div>
          <div class="scores-raw">
            Indices internes (pile / face / tranche) : 
            ${scores.pile} / ${scores.face} / ${scores.edge} · 
            Styles (joueur / archiviste / guerrier) :
            ${scores.joueur} / ${scores.archiviste} / ${scores.guerrier}
          </div>
        </div>

        <div class="result-block">
          <h3>Liens à explorer</h3>
          <p>
            Voici une petite sélection de portes correspondant à ton profil.
            Tu peux remplacer ces URLs par tes propres ressources, dossiers, sites ou expériences.
          </p>
          <ul class="links-list">
            ${linksHtml}
          </ul>
        </div>
      </div>
    `;

    // Adapte les boutons
    btnBack.disabled = false;
  }

  // --- Gestion des boutons ---

  btnNext.addEventListener("click", () => {
    const totalSteps = QUESTIONS.length;

    if (currentStep === -1) {
      currentStep = 0;
      render();
      return;
    }

    if (currentStep >= 0 && currentStep < totalSteps) {
      if (answers[currentStep] === null) return; // sécurité
      currentStep++;
      render();
      return;
    }

    // écran final : relancer
    resetAll();
  });

  btnBack.addEventListener("click", () => {
    if (currentStep === -1) {
      return;
    }
    if (currentStep === QUESTIONS.length) {
      // depuis le résultat : revenir à la dernière question
      currentStep = QUESTIONS.length - 1;
      render();
      btnBack.textContent = "Revenir";
      return;
    }
    if (currentStep > 0) {
      currentStep--;
      render();
    } else {
      currentStep = -1;
      render();
    }
  });

  btnReset.addEventListener("click", () => {
    resetAll();
  });

  function resetAll() {
    for (let i = 0; i < answers.length; i++) answers[i] = null;
    currentStep = -1;
    btnBack.textContent = "Revenir";
    render();
  }

  // Première vue
  render();
</script>
</body>
</html>
