<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>NOESIS / internal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --accent: #22c55e;
      --accent2: #0ea5e9;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.4);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-mono: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      font-family: var(--font-main);
      background: var(--bg-soft);
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    a { color: inherit; }

    .page {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .shell {
      width: 100%;
      max-width: 700px;
      text-align: center;
    }

    .logo {
      font-family: var(--font-mono);
      font-size: 2.2rem;
      letter-spacing: 0.18em;
      margin-bottom: 4px;
    }

    .slogan {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 20px;
    }

    .search-box {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #020617;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 6px 12px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.7);
    }

    .search-icon {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .search-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
      font-family: var(--font-main);
    }

    .search-input::placeholder {
      color: #6b7280;
    }

    .hint-row {
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
      text-align: left;
    }

    .hint-keywords span {
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 3px 7px;
      margin-right: 4px;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--muted);
      cursor: pointer;
    }

    .hint-keywords span:hover {
      border-color: rgba(34, 197, 94, 0.8);
      color: #bbf7d0;
    }

    .results {
      margin-top: 20px;
      text-align: left;
    }

    .result-card {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      padding: 8px 9px;
      margin-bottom: 10px;
      font-size: 0.84rem;
    }

    .result-title {
      font-size: 0.9rem;
      margin-bottom: 3px;
    }

    .result-meta {
      font-size: 0.72rem;
      color: var(--muted);
      margin-bottom: 4px;
      font-family: var(--font-mono);
    }

    .result-snippet {
      font-size: 0.8rem;
      color: var(--text);
      margin-bottom: 6px;
    }

    .result-tags {
      font-size: 0.7rem;
      color: var(--muted);
      font-family: var(--font-mono);
    }

    .result-actions {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: transparent;
      color: var(--text);
      font-size: 0.75rem;
      padding: 4px 9px;
      cursor: pointer;
      font-family: var(--font-mono);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn:hover {
      border-color: rgba(34, 197, 94, 0.9);
      color: #bbf7d0;
    }

    .btn-primary {
      border-color: rgba(34, 197, 94, 0.9);
    }

    .code-block {
      margin-top: 6px;
      font-family: var(--font-mono);
      font-size: 0.72rem;
      background: #020617;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 6px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .small {
      font-size: 0.74rem;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal {
      width: min(90vw, 860px);
      max-height: 90vh;
      background: #020617;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }

    .modal-title {
      font-family: var(--font-mono);
    }

    .modal-close {
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      font-size: 1rem;
    }

    .modal-body {
      padding: 8px 10px;
      overflow: auto;
      font-size: 0.82rem;
    }

    .modal-body iframe,
    .modal-body object {
      width: 100%;
      height: 65vh;
      border: none;
      background: #020617;
    }

    .quiz-question {
      margin-bottom: 10px;
    }

    .quiz-question h4 {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    .quiz-options label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 3px;
    }

    .quiz-result {
      margin-top: 8px;
      font-size: 0.8rem;
    }

    footer {
      padding: 6px 10px 8px;
      font-size: 0.7rem;
      color: var(--muted);
      text-align: center;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
    }

    footer a {
      text-decoration: underline;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .logo { font-size: 1.8rem; }
      .hint-row { font-size: 0.7rem; }
    }
  </style>
</head>
<body>
<div class="page">
  <div class="shell">
    <div class="logo">NOESIS</div>
    <div class="slogan">Don't be evil, just do it.</div>

    <form class="search-box" id="searchForm">
      <span class="search-icon">⌕</span>
      <input
        class="search-input"
        id="searchInput"
        type="text"
        autocomplete="off"
        placeholder="Tapez une requête interne (ex : surveillance, IA, annexe, faq, quiz)…"
      />
    </form>

    <div class="hint-row">
      <div class="hint-keywords">
        <span data-q="surveillance">surveillance</span>
        <span data-q="IA">IA</span>
        <span data-q="autoritarisme">autoritarisme</span>
        <span data-q="climat">climat</span>
        <span data-q="annexe">annexe</span>
        <span data-q="faq">faq</span>
        <span data-q="quiz">quiz</span>
      </div>
      <div>
        <span class="small">Interface hermétique. Tout est derrière la barre de recherche.</span>
      </div>
    </div>

    <div class="results" id="results"></div>
  </div>
</div>

<footer>
  <span>Page minimale. Moteur interne complet. Aucun appel serveur.</span><br />
  <span>Astuce : cliquez sur <a id="footerFaq">faq</a> ou tapez « faq » dans la barre.</span>
</footer>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" id="modalClose">✕</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
  // CONFIG : chemin vers ton PDF d'annexe (mets dystopie.pdf à côté de ce fichier)
  const ANNEX_URL = "dystopie.pdf";

  // Base de "documents" internes (tout est ici)
  const corpus = [
    {
      id: "surveillance",
      type: "article",
      title: "Surveillance de masse : du discours sécuritaire à la société de notation",
      meta: "Note interne / Surveillance / Dérives 2020+",
      tags: ["surveillance", "big brother", "caméras", "IA", "crédit social"],
      keywords: ["surveillance", "big brother", "caméra", "reconnaissance faciale", "chine", "crédit social"],
      snippet:
        "Caméras « intelligentes », reconnaissance faciale, scoring social : la frontière entre sécurité et contrôle systémique s’efface. En 2019, au moins 75 États déployaient déjà des technologies de surveillance assistées par IA.",
      detail:
        "Les systèmes de vidéosurveillance couplés à l’intelligence artificielle se banalisent : villes « sûres », frontières automatisées, scoring comportemental… La Chine a généralisé un maillage de centaines de millions de caméras, combiné à des dispositifs de crédit social et de profilage ethnique, notamment au Xinjiang. Dans les régimes autoritaires, la surveillance sert au contrôle social ; dans les démocraties, elle est justifiée par la sécurité ou la santé publique, avec un risque de glissement progressif si les contre-pouvoirs restent faibles."
    },
    {
      id: "ia",
      type: "article",
      title: "IA de gouvernance : quand l’algorithme devient guichet unique et juge de paix",
      meta: "Note interne / IA / Gouvernance",
      tags: ["IA", "biais", "fraude sociale", "police prédictive"],
      keywords: ["ia", "algorithme", "biais", "police prédictive", "fraude", "allocations", "toeslagen"],
      snippet:
        "Scoring fiscal automatisé, reconnaissance faciale policière, justice prédictive : l’IA ne remplace pas l’État, elle rigidifie ses réflexes.",
      detail:
        "Dans plusieurs pays, des algorithmes ont détecté des « fraudes » massives là où il n’y avait que des erreurs administratives. Aux Pays-Bas, un système de détection de fraude aux allocations a ciblé des milliers de familles sur des critères bancals, les plongeant dans la ruine avant que la justice ne reconnaisse l’ampleur de l’erreur. Ailleurs, des logiciels de reconnaissance faciale ont conduit à des arrestations injustifiées, principalement de personnes racisées. L’illusion d’objectivité masque des biais puissants et la difficulté à contester des décisions automatiques."
    },
    {
      id: "autoritarisme",
      type: "article",
      title: "Autoritarisme du XXIe siècle : moins de bottes, plus d’algorithmes",
      meta: "Synthèse / Démocratie en recul",
      tags: ["autoritarisme", "digital", "répression"],
      keywords: ["autoritarisme", "dictature", "répression", "protestation", "lois d'exception"],
      snippet:
        "Répressions massives de manifestations, lois d’exception prolongées, vernis légal sur la censure : l’érosion des libertés suit une courbe lente mais continue.",
      detail:
        "Les coups d’État classiques côtoient désormais des dérives plus soft : constitution modifiée pour prolonger un mandat, lois « anti-fake news » utilisées pour emprisonner des journalistes, surveillance numérique des opposants. Les prisons se remplissent de reporters, militants et figures de la société civile. La dystopie politique actuelle n’est pas un seul Big Brother mondial, mais une mosaïque de régimes locaux verrouillés, chacun avec son propre mélange de répression, propagande et technologies intrusives."
    },
    {
      id: "climat",
      type: "article",
      title: "Climat, migrations et tentations éco-autoritaires",
      meta: "Note interne / Environnement / Risques politiques",
      tags: ["climat", "écofascisme", "réfugiés climatiques"],
      keywords: ["climat", "écofascisme", "migration", "réfugiés", "ressources"],
      snippet:
        "Crises climatiques, déplacements forcés, tensions sur les ressources : le terrain est prêt pour des discours écofascistes qui désignent des populations « en trop ».",
      detail:
        "Les catastrophes environnementales déplacent déjà des dizaines de millions de personnes à l’intérieur de leurs pays, alimentant des tensions sociales. Des mouvances extrémistes recyclent le vocabulaire écologique pour désigner des groupes ethniques ou des migrants comme menace principale pour la planète. Dans un scénario extrême, des régimes pourraient restreindre brutalement les libertés au nom de l’urgence écologique : rationnements autoritaires, frontières militarisées, hiérarchisation des vies à préserver."
    },
    {
      id: "annexe",
      type: "annexe",
      title: "Annexe complète : rapport sur les dérives dystopiques actuelles",
      meta: "Document PDF / Base théorique",
      tags: ["pdf", "annexe", "rapport complet"],
      keywords: ["annexe", "rapport", "pdf", "dystopie"],
      snippet:
        "Version longue : surveillance, contrôle de l’information, libertés civiles, IA, biotechnologies, autoritarisme, climat. Document de référence pour l’analyse et le quiz.",
      detail:
        "L’annexe compile des cas documentés : généralisation des technologies de surveillance, lois anti-fake news détournées, criminalisation de la contestation, dérives de l’IA dans la justice ou les prestations sociales, risques biotechnologiques et effondrement environnemental. Utilisez-la comme base théorique pour former, documenter ou concevoir des scénarios.",
      embed: { kind: "pdf", url: ANNEX_URL }
    },
    {
      id: "faq",
      type: "faq",
      title: "FAQ : brancher d’autres documents sur ce moteur interne",
      meta: "Guide technique / Intégration de contenu",
      tags: ["faq", "intégration", "docs"],
      keywords: ["faq", "aide", "intégrer", "documents", "pdf", "youtube", "image", "spotify"],
      snippet:
        "Ce moteur est 100 % statique. Tout se joue dans la constante « corpus » et dans quelques fonctions de rendu.",
      detail:
        "Pour ajouter des documents ou fonctionnalités, vous n’avez qu’à étendre le tableau « corpus » dans le script. Chaque entrée correspond à un résultat possible : article textuel, annexe PDF, image, vidéo, playlist, quiz, etc. Les champs clés sont : id, type, title, meta, tags, keywords, snippet, detail, et éventuellement embed.\n\nLe moteur fait une recherche très simple : il regarde si des mots-clés de l’entrée sont contenus dans la requête. À partir de là, il rend une carte de résultat et, si « embed » est présent, propose un bouton pour ouvrir le contenu en modale."
    },
    {
      id: "faq-tech",
      type: "faq",
      title: "Comment ajouter PDF, images, YouTube, playlists…",
      meta: "Exemples d’entrées corpus",
      tags: ["faq", "embed", "exemples"],
      keywords: ["pdf", "image", "youtube", "spotify", "playlist", "intégrer"],
      snippet:
        "Tout ce que le navigateur sait afficher peut être branché dans une modale via « embed ».",
      detail:
        "Exemples à suivre :\n\n1) Ajouter un autre PDF local :\n{\n  id: \"memo-ai\",\n  type: \"annexe\",\n  title: \"Mémo interne IA\",\n  meta: \"PDF / interne\",\n  tags: [\"pdf\", \"IA\"],\n  keywords: [\"memo\", \"IA\"],\n  snippet: \"Note technique sur les risques IA.\",\n  detail: \"Version longue du mémo IA.\",\n  embed: { kind: \"pdf\", url: \"memo-ia.pdf\" }\n}\n\n2) Ajouter une image (schéma, carte d’acteurs) :\n{\n  id: \"schema-acteurs\",\n  type: \"media\",\n  title: \"Cartographie d’acteurs – exemple\",\n  meta: \"Image locale\",\n  tags: [\"image\", \"cartographie\"],\n  keywords: [\"schéma\", \"cartographie\"],\n  snippet: \"Schéma d’exemple pour illustrer une note.\",\n  detail: \"Cette image peut être un organigramme, une carte d’acteurs, etc.\",\n  embed: { kind: \"image\", url: \"schemas/acteurs.png\" }\n}\n\n3) Intégrer une vidéo YouTube (sera chargée si vous êtes en ligne) :\n{\n  id: \"yt-surveillance\",\n  type: \"media\",\n  title: \"Présentation vidéo – Surveillance et libertés\",\n  meta: \"YouTube / externe\",\n  tags: [\"youtube\", \"video\"],\n  keywords: [\"youtube\", \"video\", \"surveillance\"],\n  snippet: \"Conférence publique sur la surveillance.\",\n  detail: \"Vidéo à ouvrir en contexte sécurisé.\",\n  embed: { kind: \"youtube\", url: \"https://www.youtube.com/embed/XXXXXXXX\" }\n}\n\n4) Intégrer une playlist (Spotify, etc.) : même principe, avec kind: \"spotify\" et un URL d’embed.\n\nLe code de rendu vérifie le champ embed.kind et choisit le bon iframe/object. Rien ne sort de ce fichier tant que vous restez sur des ressources locales."
    },
    {
      id: "quiz",
      type: "quiz",
      title: "Quiz : avez-vous vraiment lu l’annexe ?",
      meta: "Évaluation rapide / 3 questions",
      tags: ["quiz", "annexe", "dystopie"],
      keywords: ["quiz", "test", "evaluation", "annexe"],
      snippet:
        "Trois questions basées sur le rapport d’annexe : surveillance, IA et gouvernance autoritaire.",
      detail:
        "Les réponses s’appuient sur les exemples et chiffres évoqués dans le rapport d’annexe. L’objectif n’est pas la note, mais de voir ce qui a été retenu des tendances dystopiques actuelles."
    }
  ];

  // Quiz questions (liées au contenu de l’annexe)
  const quizQuestions = [
    {
      q: "1. Dans l’exemple de société de surveillance la plus avancée, quel pays combine caméras, crédit social et profilage ethnique ?",
      options: ["États-Unis", "Chine", "Brésil", "Norvège"],
      answer: 1
    },
    {
      q: "2. Quel scandale a mis en lumière un logiciel espion utilisé contre des journalistes et militants dans de nombreux pays ?",
      options: ["WikiLeaks", "Pegasus", "Cambridge Analytica", "XKeyscore"],
      answer: 1
    },
    {
      q: "3. Dans quel pays un algorithme de détection de fraude sociale a-t-il poussé des milliers de familles dans la misère avant d’être reconnu comme abusif ?",
      options: ["Pays-Bas", "Canada", "Grèce", "Afrique du Sud"],
      answer: 0
    }
  ];

  const searchForm = document.getElementById("searchForm");
  const searchInput = document.getElementById("searchInput");
  const resultsEl = document.getElementById("results");
  const modalOverlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");
  const modalClose = document.getElementById("modalClose");

  function normalize(str) {
    return (str || "").toLowerCase();
  }

  function search(query) {
    const q = normalize(query);
    if (!q) return [];

    // matching très simple
    const results = corpus.filter(item => {
      const ks = (item.keywords || []).map(normalize);
      const inKw = ks.some(k => q.includes(k));
      const inTitle = normalize(item.title).includes(q);
      return inKw || inTitle;
    });

    // petits easter eggs légers
    if (q === "google") {
      results.unshift({
        id: "egg-google",
        type: "article",
        title: "Requête externe non autorisée",
        meta: "Contrôle de périmètre",
        tags: ["échec", "externe"],
        snippet:
          "Ce moteur ne résout pas vos requêtes vers l’extérieur. Vous avez déjà vu ce que ça donne.",
        detail:
          "Ici, aucune fuite vers des services tiers non maîtrisés. Tout ce qui est interrogé se trouve dans ce fichier, ou dans les documents que vous y rattachez. Si vous cherchez une sortie, c’est sans doute que vous n’avez pas encore ouvert l’annexe."
      });
    }

    if (q === "earl" || q === "earl ") {
      results.unshift({
        id: "egg-earl",
        type: "article",
        title: "Réponse pseudo-aléatoire générée",
        meta: "Bot interne",
        tags: ["ia", "humour sec"],
        snippet:
          "E.A.R.L. déclare ne pas être responsable de ce que vous lui faites écrire. Mais il prend la mission.",
        detail:
          "Ce moteur peut être alimenté par une IA tant que la logique reste : 1 fichier, 0 backend, 100% maîtrisé par vous. Demandez à E.A.R.L. de régénérer ce corpus avec vos propres documents, questions et scénarios, puis remplacez simplement la constante « corpus »."
      });
    }

    return results;
  }

  function renderResults(results, query) {
    resultsEl.innerHTML = "";
    if (!query) {
      resultsEl.innerHTML =
        '<div class="result-card small">Tapez un mot-clé (surveillance, IA, annexe, faq, quiz…) pour interroger l’intranet.</div>';
      return;
    }
    if (!results.length) {
      resultsEl.innerHTML =
        '<div class="result-card small">Aucun résultat pour « ' +
        query +
        ' ».<br />Essayez : <code>surveillance</code>, <code>IA</code>, <code>autoritarisme</code>, <code>climat</code>, <code>annexe</code>, <code>faq</code>, <code>quiz</code>.</div>';
      return;
    }

    results.forEach(item => {
      const card = document.createElement("article");
      card.className = "result-card";

      const title = document.createElement("div");
      title.className = "result-title";
      title.textContent = item.title;

      const meta = document.createElement("div");
      meta.className = "result-meta";
      meta.textContent = item.meta || "";

      const snippet = document.createElement("div");
      snippet.className = "result-snippet";
      snippet.textContent = item.snippet || "";

      const tags = document.createElement("div");
      tags.className = "result-tags";
      tags.textContent = (item.tags || []).map(t => "#" + t).join("  ");

      card.appendChild(title);
      card.appendChild(meta);
      card.appendChild(snippet);
      card.appendChild(tags);

      const actions = document.createElement("div");
      actions.className = "result-actions";

      // bouton "ouvrir le détail"
      const btnDetail = document.createElement("button");
      btnDetail.className = "btn btn-primary";
      btnDetail.textContent = "Ouvrir le détail";
      btnDetail.addEventListener("click", () => openDetail(item));
      actions.appendChild(btnDetail);

      // si embed, bouton modal
      if (item.embed && item.embed.kind) {
        const btnEmbed = document.createElement("button");
        btnEmbed.className = "btn";
        btnEmbed.textContent = "Ouvrir dans une modale";
        btnEmbed.addEventListener("click", () => openEmbed(item));
        actions.appendChild(btnEmbed);
      }

      // si quiz
      if (item.type === "quiz") {
        const btnQuiz = document.createElement("button");
        btnQuiz.className = "btn";
        btnQuiz.textContent = "Lancer le quiz";
        btnQuiz.addEventListener("click", openQuiz);
        actions.appendChild(btnQuiz);
      }

      // si FAQ, ajouter mini bloc code pour montrer corpus
      if (item.type === "faq" && item.id === "faq") {
        const code = document.createElement("div");
        code.className = "code-block";
        code.textContent =
          "Astuce :\n- Ajoutez vos propres entrées dans le tableau « corpus ».\n- Mettez vos PDF / images à côté de ce fichier ou dans un sous-dossier.\n- Utilisez le champ « embed » pour ouvrir le contenu en modale.";
        card.appendChild(code);
      }

      card.appendChild(actions);
      resultsEl.appendChild(card);
    });
  }

  function openDetail(item) {
    modalTitle.textContent = item.title;
    const body = document.createElement("div");
    const p = document.createElement("p");
    p.textContent = item.detail || item.snippet || "";
    body.appendChild(p);
    modalBody.innerHTML = "";
    modalBody.appendChild(body);
    showModal();
  }

  function openEmbed(item) {
    modalTitle.textContent = item.title;
    modalBody.innerHTML = "";

    const kind = item.embed.kind;
    const url = item.embed.url;

    if (kind === "pdf") {
      const obj = document.createElement("object");
      obj.data = url;
      obj.type = "application/pdf";
      obj.textContent =
        "Impossible d’afficher le PDF. Ouvrez-le directement : " + url;
      modalBody.appendChild(obj);
    } else if (kind === "image") {
      const img = document.createElement("img");
      img.src = url;
      img.alt = item.title;
      img.style.maxWidth = "100%";
      img.style.maxHeight = "65vh";
      modalBody.appendChild(img);
    } else if (kind === "youtube") {
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.allow =
        "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
      iframe.allowFullscreen = true;
      modalBody.appendChild(iframe);
    } else if (kind === "spotify") {
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.allow = "autoplay; clipboard-write; encrypted-media";
      modalBody.appendChild(iframe);
    } else {
      const p = document.createElement("p");
      p.textContent = "Type d’intégration non reconnu.";
      modalBody.appendChild(p);
    }

    showModal();
  }

  function openQuiz() {
    modalTitle.textContent = "Quiz sur l’annexe dystopique";
    modalBody.innerHTML = "";

    const form = document.createElement("div");

    quizQuestions.forEach((q, idx) => {
      const block = document.createElement("div");
      block.className = "quiz-question";

      const title = document.createElement("h4");
      title.textContent = q.q;
      block.appendChild(title);

      const opts = document.createElement("div");
      opts.className = "quiz-options";

      q.options.forEach((opt, i) => {
        const lab = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "q" + idx;
        radio.value = i;
        lab.appendChild(radio);
        lab.appendChild(document.createTextNode(" " + opt));
        opts.appendChild(lab);
      });

      block.appendChild(opts);
      form.appendChild(block);
    });

    const btn = document.createElement("button");
    btn.className = "btn btn-primary";
    btn.textContent = "Corriger";
    const result = document.createElement("div");
    result.className = "quiz-result";

    btn.addEventListener("click", () => {
      let score = 0;
      quizQuestions.forEach((q, idx) => {
        const radios = modalBody.querySelectorAll(
          'input[name="q' + idx + '"]'
        );
        radios.forEach(r => {
          if (r.checked && Number(r.value) === q.answer) score++;
        });
      });
      result.textContent =
        "Score : " +
        score +
        " / " +
        quizQuestions.length +
        " – à confronter avec l’annexe PDF.";
    });

    form.appendChild(btn);
    form.appendChild(result);
    modalBody.appendChild(form);
    showModal();
  }

  function showModal() {
    modalOverlay.style.display = "flex";
  }

  function hideModal() {
    modalOverlay.style.display = "none";
  }

  // Events
  searchForm.addEventListener("submit", e => {
    e.preventDefault();
    const q = searchInput.value.trim();
    const res = search(q);
    renderResults(res, q);
  });

  document.querySelectorAll(".hint-keywords span").forEach(span => {
    span.addEventListener("click", () => {
      const q = span.getAttribute("data-q") || "";
      searchInput.value = q;
      const res = search(q);
      renderResults(res, q);
    });
  });

  document.getElementById("footerFaq").addEventListener("click", () => {
    const q = "faq";
    searchInput.value = q;
    const res = search(q);
    renderResults(res, q);
  });

  modalClose.addEventListener("click", hideModal);
  modalOverlay.addEventListener("click", e => {
    if (e.target === modalOverlay) hideModal();
  });

  // État initial
  renderResults([], "");
</script>
</body>
</html>
