
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Monocpoly Â· Oligarchie vs Collectif Citoyen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020617;
      --fg: #e5e7eb;
      --soft: #9ca3af;
      --accent-player: #22c55e;
      --accent-ai: #fb7185;
      --accent-neutral: #38bdf8;

      --board-bg: #0b1120;
      --tile-border: #111827;

      --money: #facc15;
      --influence: #60a5fa;
      --legitimacy: #a855f7;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      max-width: 100%;
      min-height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.28), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(244,63,94,0.28), transparent 60%),
        linear-gradient(to bottom, #020617, #000 55%, #020617 100%);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 10px;
    }

    main {
      width: 100%;
      max-width: 1200px;
    }

    /* HEADER */

    header.site-header {
      text-align: center;
      margin-bottom: 10px;
    }

    .eyebrow {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.28em;
      color: var(--soft);
    }

    h1 {
      margin: 4px 0;
      font-size: clamp(20px, 5vw, 26px);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .subtitle {
      font-size: 12px;
      color: var(--soft);
      max-width: 700px;
      margin: 0 auto;
    }

    /* HUD TOP */

    .hud {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.4fr);
      gap: 8px;
    }

    @media (max-width: 840px) {
      .hud {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .hud-panel {
      border-radius: 18px;
      background: rgba(15,23,42,0.96);
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0,0,0,0.8);
      padding: 8px 10px;
      font-size: 13px;
    }

    .hud-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--soft);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .hud-resources {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .res-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 7px;
      font-size: 12px;
      border: 1px solid #334155;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.4), transparent 60%);
    }

    .res-icon {
      font-size: 13px;
    }

    .res-money { color: var(--money); }
    .res-infl { color: var(--influence); }
    .res-leg { color: var(--legitimacy); }

    .hud-turn {
      font-size: 12px;
      color: var(--soft);
      margin-top: 2px;
    }

    .hud-players {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      font-size: 11px;
    }

    .player-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 6px;
      border: 1px solid #334155;
      background: #020617;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid #020617;
    }

    .dot-player { background: var(--accent-player); }
    .dot-ai { background: var(--accent-ai); }
    .dot-neutral { background: var(--accent-neutral); }

    /* LAYOUT PRINCIPAL */

    .layout {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.1fr);
      gap: 10px;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      }
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .panel {
      border-radius: 18px;
      background: rgba(15,23,42,0.96);
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0,0,0,0.85);
      padding: 10px 11px 12px;
      font-size: 13px;
    }

    .panel h2 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin: 0 0 6px;
    }

    .panel p {
      font-size: 12px;
      margin: 3px 0;
      color: var(--soft);
    }

    /* BOARD */

    .board-wrapper {
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.25), transparent 60%);
      border-radius: 18px;
      padding: 6px;
      border: 1px solid #0f172a;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(6, minmax(0,1fr));
      gap: 5px;
      background: var(--board-bg);
      border-radius: 12px;
      padding: 6px;
    }

    .tile {
      position: relative;
      border-radius: 9px;
      border: 2px solid var(--tile-border);
      background: #020617;
      padding: 4px 4px 6px;
      min-height: 70px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, border-color 0.1s ease-out, background 0.1s ease-out;
    }

    .tile:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.9);
      border-color: #475569;
    }

    .tile-name {
      font-size: 11px;
      font-weight: 600;
    }

    .tile-sector {
      font-size: 10px;
      color: var(--soft);
    }

    .tile-cost {
      font-size: 10px;
      color: var(--money);
      margin-top: 2px;
    }

    .tile-owner-badge {
      position: absolute;
      top: 3px;
      right: 4px;
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 10px;
      border: 1px solid #020617;
      background: #020617;
      color: var(--fg);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tile-owner-badge .dot {
      width: 7px;
      height: 7px;
      border: 1px solid #020617;
    }

    .tile-owner-player .tile-owner-badge {
      background: rgba(34,197,94,0.16);
      border-color: var(--accent-player);
    }

    .tile-owner-ai .tile-owner-badge {
      background: rgba(248,113,113,0.22);
      border-color: var(--accent-ai);
    }

    .tile-footer {
      margin-top: 4px;
      font-size: 9px;
      color: var(--soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .tile-yields {
      display: inline-flex;
      gap: 3px;
      align-items: center;
    }

    .yield-pill {
      padding: 1px 4px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      font-size: 9px;
    }

    .yield-money { color: var(--money); }
    .yield-infl { color: var(--influence); }
    .yield-leg { color: var(--legitimacy); }

    .tile-warning {
      font-size: 9px;
      color: #f97316;
    }

    /* PANNEAU DE DROITE (dÃ©tails / actions) */

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .detail-title {
      font-size: 14px;
      font-weight: 600;
    }

    .detail-chip {
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 6px;
      border: 1px solid #4b5563;
      background: #020617;
      color: var(--soft);
    }

    .detail-body {
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 6px 7px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .detail-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--soft);
      margin-bottom: 3px;
    }

    .struct-list {
      list-style: none;
      padding-left: 0;
      margin: 3px 0;
      font-size: 12px;
    }

    .struct-list li {
      margin: 2px 0;
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }

    .struct-name {
      color: var(--fg);
    }

    .struct-yields {
      font-size: 11px;
      color: var(--soft);
    }

    .actions {
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at 0 0, rgba(249,115,22,0.25), transparent 60%);
      padding: 6px 7px;
      font-size: 12px;
    }

    .actions-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 4px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: var(--fg);
      font-size: 11px;
      padding: 5px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn.primary {
      border-color: var(--accent-player);
      background: radial-gradient(circle at 20% 0, #bbf7d0, #22c55e);
      color: #022c22;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 11px;
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .help-text {
      font-size: 11px;
      color: var(--soft);
      margin-top: 3px;
    }

    /* JOURNAL */

    .journal {
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: rgba(15,23,42,0.9);
      padding: 6px 7px;
      font-size: 12px;
      max-height: 260px;
      overflow-y: auto;
    }

    .journal h3 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--soft);
      margin: 0 0 4px;
    }

    .log-entry {
      margin: 2px 0;
      line-height: 1.35;
    }

    .log-entry span.time {
      color: #4ade80;
      font-size: 10px;
      margin-right: 4px;
    }

    .log-entry span.ai {
      color: var(--accent-ai);
    }

    .log-entry span.player {
      color: var(--accent-player);
    }
  </style>
</head>
<body>
<main>
  <header class="site-header">
    <div class="eyebrow">jeu de plateau politico-Ã©conomique</div>
    <h1>Monocpoly Â· Oligarchie vs Collectif Citoyen</h1>
    <p class="subtitle">
      Un mix entre Monopoli (districts Ã  acheter, rentes) et StarCraft (ressources, structures, contrÃ´le de territoire).  
      Tu es <strong>le Collectif Citoyen</strong>. En face, une IA simple incarne <strong>OligarCorp</strong>, lâ€™oligarchie financiÃ¨re.
    </p>
  </header>

  <!-- HUD TOP -->
  <section class="hud">
    <div class="hud-panel">
      <div class="hud-title">
        <span>Ressources du Collectif</span>
        <span style="font-size:11px;color:var(--soft);">Tour <span id="turnNumber">1</span></span>
      </div>
      <div class="hud-resources">
        <div class="res-pill">
          <span class="res-icon res-money">ðŸ’°</span>
          <span>Capital : <span id="resMoney">40</span></span>
        </div>
        <div class="res-pill">
          <span class="res-icon res-infl">ðŸ“£</span>
          <span>Influence : <span id="resInf">10</span></span>
        </div>
        <div class="res-pill">
          <span class="res-icon res-leg">âœ…</span>
          <span>LÃ©gitimitÃ© : <span id="resLeg">10</span></span>
        </div>
      </div>
      <div class="hud-turn" id="hudTurn">
        Tour du Collectif Citoyen. Clique sur un district, achÃ¨te-le, construis des structures, puis termine le tour.
      </div>
    </div>

    <div class="hud-panel">
      <div class="hud-title">
        <span>Ã‰tat du plateau</span>
      </div>
      <div class="hud-players">
        <span class="player-pill">
          <span class="dot dot-player"></span> Collectif Citoyen (toi)
        </span>
        <span class="player-pill">
          <span class="dot dot-ai"></span> OligarCorp (IA)
        </span>
        <span class="player-pill">
          <span class="dot dot-neutral"></span> District neutre
        </span>
      </div>
      <p style="margin-top:5px;">
        <strong>Objectif :</strong> contrÃ´ler plus de districts stratÃ©giques que lâ€™OligarCorp
        et accumuler assez de <strong>lÃ©gitimitÃ©</strong> pour peser sur le systÃ¨me sans devenir toi-mÃªme lâ€™oligarchie.
      </p>
    </div>
  </section>

  <!-- LAYOUT PRINCIPAL -->
  <section class="layout">
    <!-- Plateau -->
    <article class="panel">
      <h2>Carte des districts</h2>
      <p>
        Chaque case est un district (finance, mÃ©dias, quartier populaire, institutions, etc.).  
        Clique pour voir le dÃ©tail, acheter le district ou y construire des structures.
      </p>
      <div class="board-wrapper">
        <div id="board" class="board">
          <!-- Tuiles gÃ©nÃ©rÃ©es par JS -->
        </div>
      </div>
    </article>

    <!-- DÃ©tail district + actions + journal -->
    <aside class="panel">
      <div class="detail-header">
        <div>
          <div class="detail-title" id="detailTitle">Aucun district sÃ©lectionnÃ©</div>
          <div class="detail-chip" id="detailOwnerChip">PropriÃ©taire : â€”</div>
        </div>
        <button class="btn primary" id="endTurnBtn">Fin de tour â–¶</button>
      </div>

      <div class="detail-body">
        <div class="detail-section-title">District</div>
        <p id="detailDesc">
          Clique sur un district de la carte pour afficher ses infos (coÃ»t, secteur, structures possiblesâ€¦).
        </p>
        <p id="detailBase" style="margin-top:4px;"></p>
      </div>

      <div class="detail-body">
        <div class="detail-section-title">Structures prÃ©sentes</div>
        <ul class="struct-list" id="structList">
          <li style="font-size:11px;color:var(--soft);">Aucune structure pour le moment.</li>
        </ul>
      </div>

      <div class="actions">
        <div class="detail-section-title">Actions possibles</div>
        <div class="actions-buttons">
          <button class="btn" id="btnBuy">Acheter le district</button>
          <button class="btn" id="btnBuildMedia">Construire Media Center</button>
          <button class="btn" id="btnBuildCoop">Construire Coop & Services</button>
          <button class="btn" id="btnBuildThinkTank">Construire Think Tank citoyen</button>
          <button class="btn" id="btnBuildLobby">Construire Lobby transparent</button>
        </div>
        <div class="help-text" id="actionsHelp">
          SÃ©lectionne un district. Tu peux acheter les districts neutres, puis construire des structures qui produisent des ressources chaque tour.
        </div>
      </div>

      <div class="journal" id="journal">
        <h3>Journal des Ã©vÃ©nements</h3>
        <!-- EntrÃ©es ajoutÃ©es en JS -->
      </div>
    </aside>
  </section>

  <script>
    // --- DonnÃ©es du jeu --- //

    const districts = [
      { id: 1,  name: "Quartier Financier", sector: "Finance", baseCost: 20 },
      { id: 2,  name: "Boulevard des MÃ©dias", sector: "MÃ©dias", baseCost: 18 },
      { id: 3,  name: "Zone Industrielle", sector: "Industrie", baseCost: 16 },
      { id: 4,  name: "Campus Universitaire", sector: "Savoir", baseCost: 15 },
      { id: 5,  name: "Quartier Populaire Nord", sector: "Habitat", baseCost: 12 },
      { id: 6,  name: "Parlement & Institutions", sector: "Institutions", baseCost: 22 },

      { id: 7,  name: "Parc Technologique", sector: "Tech", baseCost: 17 },
      { id: 8,  name: "Centre Commercial", sector: "Consommation", baseCost: 16 },
      { id: 9,  name: "Vieille Ville", sector: "Patrimoine", baseCost: 14 },
      { id: 10, name: "Quartier Populaire Sud", sector: "Habitat", baseCost: 12 },
      { id: 11, name: "Plaine des Festivals", sector: "Culture", baseCost: 13 },
      { id: 12, name: "Zone Logistique", sector: "Transport", baseCost: 15 },

      { id: 13, name: "Parc dâ€™Affaires", sector: "Services", baseCost: 17 },
      { id: 14, name: "HÃ´pital Central", sector: "SantÃ©", baseCost: 18 },
      { id: 15, name: "Quartier des Startups", sector: "Tech", baseCost: 16 },
      { id: 16, name: "CitÃ© Administrative", sector: "Bureaucratie", baseCost: 15 },
      { id: 17, name: "Ã‰copÃ´le Citoyen", sector: "Transition", baseCost: 14 },
      { id: 18, name: "Banlieue OubliÃ©e", sector: "Habitat", baseCost: 10 },

      { id: 19, name: "Place des RÃ©seaux Sociaux", sector: "MÃ©dias numÃ©riques", baseCost: 16 },
      { id: 20, name: "Quartier Diplomatique", sector: "International", baseCost: 20 },
      { id: 21, name: "Cluster DÃ©fense & SÃ©curitÃ©", sector: "SÃ©curitÃ©", baseCost: 18 },
      { id: 22, name: "Plateforme Logistique Globale", sector: "Globalisation", baseCost: 19 },
      { id: 23, name: "Zone Rurale PÃ©riphÃ©rique", sector: "Rural", baseCost: 11 },
      { id: 24, name: "Centre des CongrÃ¨s", sector: "Lobby & Ã©vÃ©nements", baseCost: 17 },

      { id: 25, name: "Quartier RÃ©sidentiel Calme", sector: "Habitat", baseCost: 13 },
      { id: 26, name: "Ceinture de Bureaux Anonyme", sector: "Services", baseCost: 14 },
      { id: 27, name: "Friche en Reconversion", sector: "Transition", baseCost: 12 },
      { id: 28, name: "Plateforme MÃ©dia IndÃ©pendant", sector: "MÃ©dias", baseCost: 16 },
      { id: 29, name: "Grand Stade & Sports", sector: "Sport", baseCost: 15 },
      { id: 30, name: "Campus Art & Design", sector: "Culture", baseCost: 14 },

      { id: 31, name: "Quartier Mixte en Gentrification", sector: "Habitat", baseCost: 15 },
      { id: 32, name: "Immeubles FantÃ´mes Offshores", sector: "Finance opaque", baseCost: 21 },
      { id: 33, name: "Data Center Global", sector: "DonnÃ©es", baseCost: 19 },
      { id: 34, name: "Centre de DÃ©cision Oligarchique", sector: "Pouvoir", baseCost: 23 },
      { id: 35, name: "Maison des Associations", sector: "CitoyennetÃ©", baseCost: 13 },
      { id: 36, name: "Place du Commun", sector: "Communs", baseCost: 15 }
    ];

    const structuresCatalog = {
      mediaCenter: {
        id: "mediaCenter",
        name: "Media Center citoyen",
        costMoney: 8,
        costInf: 4,
        yields: { money: 1, inf: 4, leg: 2 },
        desc: "Plateforme mÃ©dia indÃ©pendante, renforce lâ€™influence et la lÃ©gitimitÃ©."
      },
      coop: {
        id: "coop",
        name: "Coop & Services de quartier",
        costMoney: 6,
        costInf: 2,
        yields: { money: 2, inf: 2, leg: 2 },
        desc: "Ã‰conomie coopÃ©rative & services de proximitÃ©. Ancrage local."
      },
      thinkTank: {
        id: "thinkTank",
        name: "Think Tank citoyen",
        costMoney: 10,
        costInf: 4,
        yields: { money: 0, inf: 4, leg: 4 },
        desc: "Production dâ€™idÃ©es, Ã©tudes, argumentaires. Arme douce."
      },
      lobby: {
        id: "lobby",
        name: "Lobby transparent",
        costMoney: 9,
        costInf: 5,
        yields: { money: 1, inf: 3, leg: 3 },
        desc: "Influence lÃ©gale & assumÃ©e sur les institutions."
      }
    };

    // Ã‰tat des cases
    const tileState = districts.map(d => ({
      id: d.id,
      owner: "neutral",   // "player" | "ai" | "neutral"
      structures: [],      // ids de structures
      locked: false        // pour Ã©viter des constructions infinies IA dans un tour
    }));

    // Ã‰tat global du joueur / IA
    let turn = 1;
    let isPlayerTurn = true;

    const playerRes = { money: 40, inf: 10, leg: 10 };
    const aiRes = { money: 40, inf: 8, leg: 5 };

    // SÃ©lection du district
    let selectedTileId = null;

    // --- RÃ©fÃ©rences DOM --- //
    const boardEl = document.getElementById("board");
    const resMoneyEl = document.getElementById("resMoney");
    const resInfEl = document.getElementById("resInf");
    const resLegEl = document.getElementById("resLeg");
    const turnNumberEl = document.getElementById("turnNumber");
    const hudTurnEl = document.getElementById("hudTurn");

    const detailTitleEl = document.getElementById("detailTitle");
    const detailOwnerChipEl = document.getElementById("detailOwnerChip");
    const detailDescEl = document.getElementById("detailDesc");
    const detailBaseEl = document.getElementById("detailBase");
    const structListEl = document.getElementById("structList");
    const actionsHelpEl = document.getElementById("actionsHelp");
    const journalEl = document.getElementById("journal");

    const endTurnBtn = document.getElementById("endTurnBtn");
    const btnBuy = document.getElementById("btnBuy");
    const btnBuildMedia = document.getElementById("btnBuildMedia");
    const btnBuildCoop = document.getElementById("btnBuildCoop");
    const btnBuildThinkTank = document.getElementById("btnBuildThinkTank");
    const btnBuildLobby = document.getElementById("btnBuildLobby");

    // --- Construction du plateau --- //

    function buildBoard() {
      boardEl.innerHTML = "";
      districts.forEach(d => {
        const state = tileState.find(t => t.id === d.id);
        const tile = document.createElement("button");
        tile.className = "tile";
        tile.dataset.id = d.id;

        const yields = computeTileYields(state);

        let yieldsHtml = "";
        if (yields.money || yields.inf || yields.leg) {
          yieldsHtml = `
            <span class="tile-yields">
              ${yields.money ? `<span class="yield-pill yield-money">+${yields.money}ðŸ’°</span>` : ""}
              ${yields.inf ? `<span class="yield-pill yield-infl">+${yields.inf}ðŸ“£</span>` : ""}
              ${yields.leg ? `<span class="yield-pill yield-leg">+${yields.leg}âœ…</span>` : ""}
            </span>
          `;
        }

        let warningHtml = "";
        if (state.owner === "ai") {
          warningHtml = `<span class="tile-warning">Zone captÃ©e par lâ€™oligarchie</span>`;
        }

        tile.innerHTML = `
          <div class="tile-name">${d.name}</div>
          <div class="tile-sector">${d.sector}</div>
          <div class="tile-cost">CoÃ»t de base : ${d.baseCost}ðŸ’°</div>
          ${ownerBadgeHtml(state.owner)}
          <div class="tile-footer">
            ${yieldsHtml || "<span>Pas encore de structure.</span>"}
            ${warningHtml}
          </div>
        `;

        if (state.owner === "player") {
          tile.classList.add("tile-owner-player");
        } else if (state.owner === "ai") {
          tile.classList.add("tile-owner-ai");
        }

        boardEl.appendChild(tile);
      });
    }

    function ownerBadgeHtml(owner) {
      if (owner === "player") {
        return `
          <div class="tile-owner-badge">
            <span class="dot dot-player"></span><span>Collectif</span>
          </div>`;
      }
      if (owner === "ai") {
        return `
          <div class="tile-owner-badge">
            <span class="dot dot-ai"></span><span>OligarCorp</span>
          </div>`;
      }
      return `
        <div class="tile-owner-badge">
          <span class="dot dot-neutral"></span><span>Neutre</span>
        </div>`;
    }

    function computeTileYields(tile) {
      let money = 0, inf = 0, leg = 0;
      tile.structures.forEach(id => {
        const s = structuresCatalog[id];
        if (!s) return;
        money += s.yields.money;
        inf += s.yields.inf;
        leg += s.yields.leg;
      });
      return { money, inf, leg };
    }

    // --- SÃ©lection & panneau de dÃ©tails --- //

    boardEl.addEventListener("click", (e) => {
      const tile = e.target.closest(".tile");
      if (!tile) return;
      const id = Number(tile.dataset.id);
      selectTile(id);
    });

    function selectTile(id) {
      selectedTileId = id;
      const d = districts.find(x => x.id === id);
      const state = tileState.find(t => t.id === id);
      const yields = computeTileYields(state);

      detailTitleEl.textContent = `#${d.id} Â· ${d.name}`;
      detailDescEl.textContent = `Secteur : ${d.sector}. District clÃ© dans la cartographie du pouvoir.`;
      detailBaseEl.textContent = `CoÃ»t de base : ${d.baseCost}ðŸ’° Â· Structures : ${state.structures.length || "aucune"}.`;

      if (state.owner === "player") {
        detailOwnerChipEl.textContent = "PropriÃ©taire : Collectif Citoyen (toi)";
        detailOwnerChipEl.style.borderColor = "var(--accent-player)";
      } else if (state.owner === "ai") {
        detailOwnerChipEl.textContent = "PropriÃ©taire : OligarCorp (IA)";
        detailOwnerChipEl.style.borderColor = "var(--accent-ai)";
      } else {
        detailOwnerChipEl.textContent = "PropriÃ©taire : Neutre";
        detailOwnerChipEl.style.borderColor = "#4b5563";
      }

      // Liste des structures
      if (!state.structures.length) {
        structListEl.innerHTML = `<li style="font-size:11px;color:var(--soft);">Aucune structure pour lâ€™instant.</li>`;
      } else {
        structListEl.innerHTML = "";
        state.structures.forEach(id => {
          const s = structuresCatalog[id];
          if (!s) return;
          const li = document.createElement("li");
          li.innerHTML = `
            <span class="struct-name">${s.name}</span>
            <span class="struct-yields">
              ${s.yields.money ? `+${s.yields.money}ðŸ’° ` : ""}
              ${s.yields.inf ? `+${s.yields.inf}ðŸ“£ ` : ""}
              ${s.yields.leg ? `+${s.yields.leg}âœ…` : ""}
            </span>`;
          structListEl.appendChild(li);
        });
      }

      // Aide contextuelle
      if (!isPlayerTurn) {
        actionsHelpEl.textContent = "Câ€™est le tour de lâ€™OligarCorp : observe ses mouvements.";
      } else if (state.owner === "player") {
        actionsHelpEl.textContent = "Tu peux construire des structures sur ce district si tu as assez de ressources.";
      } else if (state.owner === "neutral") {
        actionsHelpEl.textContent = "District neutre : tu peux lâ€™acheter si tu as assez de capital.";
      } else if (state.owner === "ai") {
        actionsHelpEl.textContent = "District contrÃ´lÃ© par lâ€™OligarCorp. Observe ses structures et prÃ©pare ta contre-stratÃ©gie.";
      }

      refreshActionButtons();
    }

    // --- Boutons dâ€™action --- //

    function refreshActionButtons() {
      const id = selectedTileId;
      const hasSel = !!id;
      const state = tileState.find(t => t.id === id);

      if (!hasSel || !isPlayerTurn) {
        btnBuy.disabled = true;
        btnBuildMedia.disabled = true;
        btnBuildCoop.disabled = true;
        btnBuildThinkTank.disabled = true;
        btnBuildLobby.disabled = true;
        return;
      }

      // Achat possible si neutre
      if (state.owner === "neutral") {
        btnBuy.disabled = playerRes.money < getDistrict(id).baseCost;
      } else {
        btnBuy.disabled = true;
      }

      // Construction possible si propriÃ©taire = player
      const canBuild = state.owner === "player";
      const money = playerRes.money;
      const inf = playerRes.inf;

      btnBuildMedia.disabled = !canBuild || money < structuresCatalog.mediaCenter.costMoney || inf < structuresCatalog.mediaCenter.costInf;
      btnBuildCoop.disabled = !canBuild || money < structuresCatalog.coop.costMoney || inf < structuresCatalog.coop.costInf;
      btnBuildThinkTank.disabled = !canBuild || money < structuresCatalog.thinkTank.costMoney || inf < structuresCatalog.thinkTank.costInf;
      btnBuildLobby.disabled = !canBuild || money < structuresCatalog.lobby.costMoney || inf < structuresCatalog.lobby.costInf;
    }

    function getDistrict(id) {
      return districts.find(d => d.id === id);
    }

    function logEntry(message, who = "player") {
      const div = document.createElement("div");
      div.className = "log-entry";
      const t = new Date();
      const time = t.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit" });
      const whoClass = who === "ai" ? "ai" : "player";
      div.innerHTML = `<span class="time">[${time}]</span><span class="${whoClass}">[${who === "ai" ? "AI" : "Toi"}]</span> ${message}`;
      journalEl.appendChild(div);
      journalEl.scrollTop = journalEl.scrollHeight;
    }

    function updateHUD() {
      resMoneyEl.textContent = playerRes.money.toFixed(0);
      resInfEl.textContent = playerRes.inf.toFixed(0);
      resLegEl.textContent = playerRes.leg.toFixed(0);
      turnNumberEl.textContent = turn;
      hudTurnEl.textContent = isPlayerTurn
        ? "Tour du Collectif Citoyen."
        : "Tour dâ€™OligarCorpâ€¦ observe comment lâ€™oligarchie tente de tout accaparer.";
    }

    // Achat de district
    btnBuy.addEventListener("click", () => {
      if (!isPlayerTurn || !selectedTileId) return;
      const state = tileState.find(t => t.id === selectedTileId);
      const d = getDistrict(selectedTileId);
      if (!state || state.owner !== "neutral") return;
      if (playerRes.money < d.baseCost) {
        logEntry("Pas assez de capital pour acheter ce district.");
        return;
      }
      playerRes.money -= d.baseCost;
      state.owner = "player";
      logEntry(`Tu achÃ¨tes ${d.name} pour ${d.baseCost}ðŸ’°.`);
      updateHUD();
      buildBoard();
      selectTile(selectedTileId);
    });

    function buildStructureOnSelected(structId) {
      if (!isPlayerTurn || !selectedTileId) return;
      const state = tileState.find(t => t.id === selectedTileId);
      if (!state || state.owner !== "player") return;
      const s = structuresCatalog[structId];
      if (!s) return;

      if (playerRes.money < s.costMoney || playerRes.inf < s.costInf) {
        logEntry(`Pas assez de ressources pour construire ${s.name}.`);
        return;
      }

      playerRes.money -= s.costMoney;
      playerRes.inf -= s.costInf;
      state.structures.push(s.id);
      logEntry(`Tu construis ${s.name} sur ${getDistrict(selectedTileId).name}.`);
      updateHUD();
      buildBoard();
      selectTile(selectedTileId);
    }

    btnBuildMedia.addEventListener("click", () => buildStructureOnSelected("mediaCenter"));
    btnBuildCoop.addEventListener("click", () => buildStructureOnSelected("coop"));
    btnBuildThinkTank.addEventListener("click", () => buildStructureOnSelected("thinkTank"));
    btnBuildLobby.addEventListener("click", () => buildStructureOnSelected("lobby"));

    // --- Fin de tour : production + tour IA --- //

    endTurnBtn.addEventListener("click", () => {
      if (!isPlayerTurn) return;

      // Production joueur
      produceResourcesFor("player");
      isPlayerTurn = false;
      updateHUD();
      refreshActionButtons();
      logEntry("Fin de ton tour. Les structures du Collectif produisent leurs ressources.");

      // Tour IA
      setTimeout(() => {
        aiTurn();
        // Production IA
        produceResourcesFor("ai");
        isPlayerTurn = true;
        turn++;
        updateHUD();
        refreshActionButtons();
        logEntry("Fin du tour de lâ€™OligarCorp. Retour Ã  toi.");
      }, 300);
    });

    function produceResourcesFor(owner) {
      let moneyGain = 0, infGain = 0, legGain = 0;

      tileState.forEach(tile => {
        if (tile.owner !== owner) return;
        const yields = computeTileYields(tile);
        moneyGain += yields.money;
        infGain += yields.inf;
        legGain += yields.leg;
      });

      if (owner === "player") {
        playerRes.money += moneyGain;
        playerRes.inf += infGain;
        playerRes.leg += legGain;
        logEntry(`Tes districts produisent : +${moneyGain}ðŸ’°, +${infGain}ðŸ“£, +${legGain}âœ….`);
      } else {
        aiRes.money += moneyGain;
        aiRes.inf += infGain;
        aiRes.leg += legGain;
        if (moneyGain + infGain + legGain > 0) {
          logEntry(`Les districts de lâ€™OligarCorp produisent des ressources en silenceâ€¦`, "ai");
        }
      }
    }

    // --- Tour IA simplifiÃ© --- //

    function aiTurn() {
      // 1) Lâ€™IA essaie dâ€™acheter un district stratÃ©gique neutre
      const neutralTiles = tileState.filter(t => t.owner === "neutral");
      if (neutralTiles.length) {
        // tri simple : coÃ»t le plus Ã©levÃ© = prioritÃ© (logique oligarchique)
        neutralTiles.sort((a,b) => getDistrict(b.id).baseCost - getDistrict(a.id).baseCost);
        const target = neutralTiles[0];
        const d = getDistrict(target.id);
        if (aiRes.money >= d.baseCost) {
          aiRes.money -= d.baseCost;
          target.owner = "ai";
          logEntry(`OligarCorp rachÃ¨te ${d.name}.`, "ai");
        }
      }

      // 2) Lâ€™IA construit une structure Ã©conomique ou mÃ©diatique sur un de ses districts
      const aiTiles = tileState.filter(t => t.owner === "ai");
      if (aiTiles.length) {
        const candidates = aiTiles.filter(t => t.structures.length < 3);
        if (candidates.length) {
          const tile = candidates[Math.floor(Math.random() * candidates.length)];
          const choice = chooseAIStructure(tile);
          if (choice && aiRes.money >= choice.costMoney && aiRes.inf >= choice.costInf) {
            aiRes.money -= choice.costMoney;
            aiRes.inf -= choice.costInf;
            tile.structures.push(choice.id);
            logEntry(`OligarCorp renforce ${getDistrict(tile.id).name} avec ${choice.name}.`, "ai");
          }
        }
      }

      buildBoard();
    }

    function chooseAIStructure(tile) {
      // IA simple : finance / influence avant la lÃ©gitimitÃ©
      const options = [structuresCatalog.coop, structuresCatalog.mediaCenter, structuresCatalog.lobby, structuresCatalog.thinkTank];
      // tri : priorise coop & lobby (rendements en money/inf)
      return options.find(o => true) || null;
    }

    // --- Initialisation --- //

    function initGame() {
      buildBoard();
      updateHUD();
      logEntry("Bienvenue dans Monocpoly. Tu incarnes le Collectif Citoyen. Commence par acheter un district clÃ©.", "player");
      refreshActionButtons();
    }

    initGame();
  </script>
</main>
</body>
</html>
