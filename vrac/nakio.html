
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>T√©l√©phone mobile 1√®re g√©n√©ration ‚Äì Archives dystopiques + Futurs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --phone-body: #1f2933;
      --phone-body-dark: #151b22;
      --screen-bg: #0b1a06;
      --screen-pixel: #c8f589;
      --screen-pixel-dim: #8cab5b;
      --accent: #32d5ff;
      --accent-strong: #6cff8f;
      --text-dim: #8c8fa5;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(circle at top, #18213b 0, #050816 55%, #000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color: var(--screen-pixel);
    }

    .desk {
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .phone {
      position: relative;
      width: min(320px, 90vw);
      border-radius: 36px;
      padding: 16px 18px 22px;
      background: radial-gradient(circle at top, #364355, var(--phone-body-dark));
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .phone::before {
      /* antenne */
      content: "";
      position: absolute;
      top: -34px;
      right: 40px;
      width: 12px;
      height: 30px;
      border-radius: 999px;
      background: linear-gradient(to bottom, #454f60, #1e252f);
      box-shadow: 0 5px 8px rgba(0, 0, 0, 0.5);
    }

    .speaker {
      width: 60px;
      height: 8px;
      border-radius: 999px;
      background: #050608;
      box-shadow:
        inset 0 0 4px rgba(255, 255, 255, 0.08),
        0 0 0 1px rgba(0, 0, 0, 0.8);
      margin-bottom: 6px;
    }

    .logo {
      font-size: 0.8rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 6px;
    }

    .logo span {
      color: var(--accent);
    }

    .screen-wrapper {
      width: 100%;
      border-radius: 18px;
      padding: 6px;
      background: radial-gradient(circle at top, #202834, var(--phone-body-dark));
      box-shadow:
        inset 0 0 6px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.08);
    }

    .screen {
      position: relative;
      width: 100%;
      height: 180px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 0, #1d3b0b, #071304 60%);
      overflow: hidden;
      padding: 6px 7px 4px;
      box-shadow:
        inset 0 0 10px #000,
        0 0 0 1px rgba(0, 0, 0, 0.9);
      font-family: "Courier New", monospace;
      color: var(--screen-pixel);
      text-shadow: 0 0 2px rgba(200, 245, 137, 0.7);
      font-size: 0.8rem;
    }

    .scanline {
      position: absolute;
      inset: 0;
      background-image: linear-gradient(
        rgba(0, 0, 0, 0) 50%,
        rgba(0, 0, 0, 0.2) 50%
      );
      background-size: 100% 2px;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
      color: var(--screen-pixel-dim);
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 1ch;
    }

    .bars {
      display: inline-flex;
      gap: 1px;
    }

    .bars span {
      width: 2px;
      border-radius: 999px;
      background: var(--screen-pixel-dim);
    }

    .bars span:nth-child(1) { height: 5px; }
    .bars span:nth-child(2) { height: 7px; }
    .bars span:nth-child(3) { height: 9px; }
    .bars span:nth-child(4) {
      height: 11px;
      background: var(--screen-pixel);
    }

    .battery {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .battery-shell {
      width: 20px;
      height: 8px;
      border-radius: 2px;
      border: 1px solid var(--screen-pixel-dim);
      position: relative;
    }

    .battery-shell::after {
      content: "";
      position: absolute;
      right: -3px;
      top: 2px;
      width: 2px;
      height: 4px;
      border-radius: 1px;
      background: var(--screen-pixel-dim);
    }

    .battery-fill {
      position: absolute;
      inset: 1px;
      border-radius: 1px;
      background: var(--screen-pixel);
    }

    .screen-content {
      margin-top: 2px;
      height: 128px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
      white-space: pre;
    }

    .cursor {
      display: inline-block;
      width: 0.5ch;
      background: var(--screen-pixel);
      animation: blink 1.1s steps(1) infinite;
      margin-left: 1px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.1%, 100% { opacity: 0; }
    }

    .softkeys {
      display: flex;
      justify-content: space-between;
      font-family: "Courier New", monospace;
      font-size: 0.75rem;
      color: var(--screen-pixel-dim);
      margin-top: 2px;
    }

    .softkey-label {
      text-transform: uppercase;
    }

    .legend {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-dim);
      text-align: center;
    }

    .keypad {
      margin-top: 10px;
      width: 100%;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
    }

    .key {
      height: 40px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #495566, #11171f);
      box-shadow:
        0 2px 0 #020509,
        0 6px 10px rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.04);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #f5f5f5;
      font-size: 0.9rem;
      cursor: pointer;
      user-select: none;
      transition: transform 0.05s ease, box-shadow 0.05s ease;
    }

    .key span.sub {
      font-size: 0.55rem;
      margin-top: 1px;
      opacity: 0.75;
      letter-spacing: 0.08em;
    }

    .key:active {
      transform: translateY(1px);
      box-shadow:
        0 1px 0 #020509,
        0 2px 4px rgba(0, 0, 0, 0.9);
    }

    .key-wide {
      grid-column: span 3;
      height: 32px;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
    }

    .key-func {
      font-size: 0.75rem;
    }

    .bottom-note {
      margin-top: 8px;
      font-size: 0.7rem;
      color: var(--text-dim);
      text-align: center;
    }

    .bottom-note span {
      color: var(--accent-strong);
    }

    @media (max-width: 360px) {
      .phone {
        padding: 14px;
      }
      .screen {
        height: 170px;
      }
    }
  </style>
</head>
<body>
  <div class="desk">
    <div class="phone" role="application" aria-label="T√©l√©phone mobile 1√®re g√©n√©ration ‚Äì Archives dystopiques + Futurs">
      <div class="speaker"></div>
      <div class="logo">RG&nbsp;<span>MOBILE</span></div>

      <div class="screen-wrapper">
        <div class="screen">
          <div class="scanline"></div>
          <div class="status-row">
            <div class="status-left">
              <span id="net-name">RG-NET</span>
              <span class="bars" aria-hidden="true">
                <span></span><span></span><span></span><span></span>
              </span>
            </div>
            <div class="status-right">
              <span id="status-time">00:00</span>
              <div class="battery">
                <div class="battery-shell">
                  <div class="battery-fill" id="battery-fill"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="screen-content" id="screen-content" aria-live="polite">
            <!-- contenu g√©n√©r√© en JS -->
          </div>

          <div class="softkeys">
            <div class="softkey-label" id="softkey-left">Menu</div>
            <div class="softkey-label" id="softkey-right">Contacts</div>
          </div>
        </div>
      </div>

      <div class="legend">
        2 / 8 = ‚Üë / ‚Üì ‚Ä¢ 5 = OK ‚Ä¢ 0 = RETOUR ‚Ä¢ * = ARCHIVES ‚Ä¢ # = DYSTOPIE ‚Ä¢ 1‚Äì5 = CHOIX FUTURS
      </div>

      <div class="keypad">
        <div class="key key-func" data-action="call">üìû</div>
        <div class="key key-func" data-action="up">‚ñ≤</div>
        <div class="key key-func" data-action="end">‚ñ†</div>

        <div class="key" data-key="1">
          1
          <span class="sub">.</span>
        </div>
        <div class="key" data-key="2">
          2
          <span class="sub">ABC ‚Üë</span>
        </div>
        <div class="key" data-key="3">
          3
          <span class="sub">DEF</span>
        </div>

        <div class="key" data-key="4">
          4
          <span class="sub">GHI</span>
        </div>
        <div class="key" data-key="5">
          5
          <span class="sub">JKL OK</span>
        </div>
        <div class="key" data-key="6">
          6
          <span class="sub">MNO</span>
        </div>

        <div class="key" data-key="7">
          7
          <span class="sub">PQRS</span>
        </div>
        <div class="key" data-key="8">
          8
          <span class="sub">TUV ‚Üì</span>
        </div>
        <div class="key" data-key="9">
          9
          <span class="sub">WXYZ</span>
        </div>

        <div class="key" data-key="*">
          *
          <span class="sub">ARCH</span>
        </div>
        <div class="key" data-key="0">
          0
          <span class="sub">RETOUR</span>
        </div>
        <div class="key" data-key="#">
          #
          <span class="sub">DYS</span>
        </div>

        <div class="key key-wide" data-action="offline">
          MODE ULTRA OFFLINE
        </div>
      </div>

      <div class="bottom-note">
        Ce t√©l√©phone traverse des <span>si√®cles</span>,  
        mais reste bloqu√© l√† o√π c'est le plus s√ªr&nbsp;: <span>hors-ligne</span>.
      </div>
    </div>
  </div>

  <script>
    // ---------- DONN√âES LORE DE BASE ----------

    const messages = [
      {
        from: "Scribe d'Ur",
        era: "-3200 av. J.-C.",
        time: "‚àû",
        text: [
          "On grave des noms dans l'argile,",
          "mais d√©j√† les rois veulent tout",
          "savoir de tout le monde."
        ]
      },
      {
        from: "Op√©ratrice t√©l√©gr.",
        era: "1870",
        time: "14:03",
        text: [
          "Les fils ne sont pas neutres.",
          "Quelqu'un lit avant que le",
          "message n'arrive."
        ]
      },
      {
        from: "Ing√©nieur r√©seau",
        era: "1999",
        time: "23:59",
        text: [
          "On relie tout. Personne ne",
          "demande vraiment ce qu'on",
          "fera des traces."
        ]
      },
      {
        from: "Toi-m√™me",
        era: "2025",
        time: "10:42",
        text: [
          "Si c'est gratuit, c'est moi",
          "le produit. Not√©.",
          "Cl√© USB > Cloud."
        ]
      },
      {
        from: "Audit IA",
        era: "2084",
        time: "04:12",
        text: [
          "Profil comportemental :",
          "anormalement discret.",
          "Raison : pas de donn√©es."
        ]
      }
    ];

    const contacts = [
      {
        name: "ANONYME 000",
        era: "??",
        note: [
          "Contact sans m√©tadonn√©es.",
          "Impossible √† mon√©tiser."
        ]
      },
      {
        name: "SCRIBE D'UR",
        era: "-3200 av. J.-C.",
        note: [
          "¬´ J'avais promis : une tablette",
          "par personne. Ils en voulaient",
          "une par pens√©e. ¬ª"
        ]
      },
      {
        name: "TELEGRAPHE N¬∞7",
        era: "1870",
        note: [
          "Premier r√©seau global.",
          "Premi√®res habitudes de",
          "surveillance syst√©matique."
        ]
      },
      {
        name: "CALL CENTER IA",
        era: "2035",
        note: [
          "Voix parfaite. Emotions",
          "simul√©es. Script optimis√©",
          "pour te faire parler."
        ]
      },
      {
        name: "TOI-DU-FUTUR",
        era: "2084",
        note: [
          "¬´ Merci pour chaque donn√©e",
          "que tu n'as pas donn√©e. ¬ª"
        ]
      }
    ];

    const calls = [
      {
        with: "SCRIBE D'UR",
        era: "-3200 av. J.-C.",
        dir: "Entrant",
        time: "‚àû",
        summary: [
          "¬´ Un jour, on n'aura plus",
          "besoin de pierre pour",
          "se souvenir de toi. ¬ª"
        ]
      },
      {
        with: "TELEGRAPHE N¬∞7",
        era: "1870",
        dir: "Sortant",
        time: "07:18",
        summary: [
          "¬´ On a r√©duit ta voix en",
          "pulses √©lectriques. C'est",
          "d√©j√† un profil. ¬ª"
        ]
      },
      {
        with: "OPERATEUR RESEAU",
        era: "2023",
        dir: "Entrant",
        time: "16:09",
        summary: [
          "¬´ C'est juste pour am√©liorer",
          "le service. On garde tout,",
          "au cas o√π. ¬ª"
        ]
      },
      {
        with: "CALL CENTER IA",
        era: "2035",
        dir: "Entrant",
        time: "19:41",
        summary: [
          "¬´ Cet appel peut √™tre",
          "enregistr√©, analys√© et",
          "revendu. Un sourire ? ¬ª"
        ]
      },
      {
        with: "TOI-DU-FUTUR",
        era: "2084",
        dir: "???",
        time: "00:00",
        summary: [
          "Silence.",
          "R√©seau non disponible.",
          "Appel pourtant r√©ussi."
        ]
      }
    ];

    const archives = [
      {
        title: "Tablettes d'argile",
        era: "-3200 av. J.-C.",
        lines: [
          "Les premiers fichiers clients",
          "√©taient en pierre.",
          "",
          "Qui √©crit contr√¥le.",
          "Qui contr√¥le retient.",
          "Qui retient s√©lectionne."
        ]
      },
      {
        title: "T√©l√©graphe & fiches",
        era: "1870‚Äì1914",
        lines: [
          "Les messages traversent les",
          "fronti√®res, les listes noires",
          "aussi.",
          "",
          "Police, arm√©e, banques :",
          "le r√©seau se souvient plus",
          "longtemps que toi."
        ]
      },
      {
        title: "T√©l√©phone fixe",
        era: "1950‚Äì1990",
        lines: [
          "On croit parler en priv√©,",
          "mais les op√©rateurs,",
          "les √âtats, √©coutent d√©j√†.",
          "",
          "Les lignes sont droites,",
          "les oreilles aussi."
        ]
      },
      {
        title: "Smartphones & clouds",
        era: "2007‚Äì2025",
        lines: [
          "Micro, cam√©ra, GPS, rythme",
          "cardiaque, amis, peurs,",
          "col√®res : tout est capt√©.",
          "",
          "La batterie est √† 12%.",
          "La confiance aussi."
        ]
      },
      {
        title: "Scoring total",
        era: "2084 ?",
        lines: [
          "Chaque appel, chaque silence,",
          "chaque absence de like est",
          "un indicateur.",
          "",
          "Solution la plus subversive :",
          "un vieux t√©l√©phone",
          "sans r√©seau."
        ]
      }
    ];

    // ---------- ARBRE DE FUTURS POSSIBLES ----------

    const futures = {
      start: {
        title: "Point de bifurcation",
        lines: [
          "Tu arrives √† un carrefour.",
          "Un choix minuscule aujourd‚Äôhui",
          "change tout demain."
        ],
        choices: [
          { label: "1 ‚Ä¢ Tout connecter", next: "full_connect" },
          { label: "2 ‚Ä¢ Connecter utile", next: "partial_connect" },
          { label: "3 ‚Ä¢ D√©connecter", next: "disconnect" },
          { label: "4 ‚Ä¢ D√©l√©guer aux IA", next: "delegate" },
          { label: "5 ‚Ä¢ Low-tech local", next: "lowtech" }
        ]
      },

      full_connect: {
        title: "Hyper-connexion",
        lines: [
          "Tout est synchronis√© :",
          "frigo, sommeil, voix,",
          "√©motions pr√©dites.",
          "",
          "Tu gagnes du confort.",
          "Tu perds ton histoire."
        ],
        choices: [
          { label: "0 ‚Ä¢ Retour", next: "start" },
          { label: "5 ‚Ä¢ Continuer", next: "full_connect_end" }
        ]
      },

      full_connect_end: {
        title: "2089 ‚Ä¢ Lissage total",
        lines: [
          "Tu n'as plus d‚Äôhumeur propre.",
          "Algorithmes lissent tout.",
          "Pas de tristesse‚Ä¶",
          "mais plus de joie non plus.",
          "",
          "Tu n‚Äôes plus suivi:",
          "tu es *pr√©-vu*."
        ],
        choices: [
          { label: "0 ‚Ä¢ Recommencer", next: "start" }
        ]
      },

      partial_connect: {
        title: "Connexion utile",
        lines: [
          "Tu connectes le vital,",
          "mais tu refuses le reste.",
          "",
          "Assez pour vivre bien,",
          "pas assez pour √™tre profil√©."
        ],
        choices: [
          { label: "1 ‚Ä¢ Tu r√©sistes", next: "partial_resist" },
          { label: "2 ‚Ä¢ Tu c√®des", next: "full_connect" },
          { label: "0 ‚Ä¢ Retour", next: "start" }
        ]
      },

      partial_resist: {
        title: "2037 ‚Ä¢ R√©silience",
        lines: [
          "Tu refuses l‚Äô√©quilibre parfait.",
          "Tu gardes ton chaos humain.",
          "",
          "Ce n‚Äôest pas rentable.",
          "Donc c‚Äôest rare.",
          "Donc pr√©cieux."
        ],
        choices: [
          { label: "0 ‚Ä¢ Retour", next: "start" }
        ]
      },

      disconnect: {
        title: "D√©connexion",
        lines: [
          "Tu sors du r√©seau.",
          "Le monde te trouve lent.",
          "Tu te trouves enfin libre.",
          "",
          "Les pubs ne te voient plus."
        ],
        choices: [
          { label: "1 ‚Ä¢ Tu continues", next: "disconnect_end" },
          { label: "2 ‚Ä¢ Tu reviens", next: "partial_connect" },
          { label: "0 ‚Ä¢ Retour", next: "start" }
        ]
      },

      disconnect_end: {
        title: "2055 ‚Ä¢ Hors-grille",
        lines: [
          "Tu vis dans un monde connect√©",
          "sans contribuer √† la matrice.",
          "",
          "Tu deviens une anomalie.",
          "Donc on te laisse tranquille."
        ],
        choices: [
          { label: "0 ‚Ä¢ Recommencer", next: "start" }
        ]
      },

      delegate: {
        title: "D√©l√©gation aux IA",
        lines: [
          "Tu leur confies tout.",
          "Elles optimisent tout.",
          "",
          "On d√©l√®gue souvent",
          "ce qu‚Äôon ne comprend plus‚Ä¶"
        ],
        choices: [
          { label: "1 ‚Ä¢ Laisser faire", next: "delegate_end" },
          { label: "0 ‚Ä¢ Retour", next: "start" }
        ]
      },

      delegate_end: {
        title: "2101 ‚Ä¢ Optimisation finale",
        lines: [
          "Elles anticipent tes besoins.",
          "Puis tes choix.",
          "Puis tes pr√©f√©rences.",
          "",
          "Puis ta place."
        ],
        choices: [
          { label: "0 ‚Ä¢ Recommencer", next: "start" }
        ]
      },

      lowtech: {
        title: "Low-tech local",
        lines: [
          "Tu privil√©gies le simple,",
          "le local, le lisible.",
          "",
          "Le monde te croit r√©tro.",
          "Il n‚Äôa pas compris",
          "que tu regardes devant."
        ],
        choices: [
          { label: "1 ‚Ä¢ Continuer", next: "lowtech_end" },
          { label: "0 ‚Ä¢ Retour", next: "start" }
        ]
      },

      lowtech_end: {
        title: "2068 ‚Ä¢ Futur clair",
        lines: [
          "Les syst√®mes tombent",
          "mais ton autonomie reste.",
          "",
          "Ton pass√© n'√©tait pas stock√©",
          "dans des serveurs fragiles.",
          "",
          "Donc il n‚Äôa pas disparu."
        ],
        choices: [
          { label: "0 ‚Ä¢ Recommencer", next: "start" }
        ]
      }
    };

    // ---------- √âTAT ----------

    const state = {
      screen: "idle",          // idle | menu | messages | msgView | contacts | contactView | calls | callView | archives | archiveView | dystopia | offline | about | futures
      menuIndex: 0,
      messageIndex: 0,
      contactIndex: 0,
      callIndex: 0,
      archiveIndex: 0,
      futureNode: "start",
      time: ""
    };

    const screenContentEl = document.getElementById("screen-content");
    const softLeftEl = document.getElementById("softkey-left");
    const softRightEl = document.getElementById("softkey-right");
    const statusTimeEl = document.getElementById("status-time");
    const batteryFillEl = document.getElementById("battery-fill");

    // ---------- UTILITAIRES ----------

    function pad(n) {
      return n.toString().padStart(2, "0");
    }

    function setBattery() {
      if (!batteryFillEl) return;
      const level = 0.45 + Math.random() * 0.4; // ~45‚Äì85%
      batteryFillEl.style.width = `${Math.round(level * 100)}%`;
    }

    setBattery();

    function updateTime() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes();
      const timeStr = `${pad(h)}:${pad(m)}`;
      state.time = timeStr;
      if (statusTimeEl) statusTimeEl.textContent = timeStr;
      if (state.screen === "idle") renderScreen();
    }

    updateTime();
    setInterval(updateTime, 60 * 1000);

    // ---------- RENDU ----------

    const menuItems = [
      "Messages (√©poques)",
      "Contacts",
      "Journal d'appels",
      "Archives",
      "Futurs possibles",
      "R√©glages sobres",
      "Dystopie ?"
    ];

    function renderScreen() {
      if (!screenContentEl) return;

      let content = "";
      let leftSoft = "";
      let rightSoft = "";

      switch (state.screen) {
        case "idle":
          leftSoft = "Menu";
          rightSoft = "Contacts";
          content += "      " + (state.time || "00:00") + "\n\n";
          content += "   RG MOBILE 1.0 LORE\n\n";
          content += "   Appuie sur [Menu] ou\n";
          content += "   5 (OK) pour ouvrir les\n";
          content += "   archives du r√©seau.\n\n";
          content += "   USB ‚Ä¢ hors-ligne ‚Ä¢ SIM";
          break;

        case "menu":
          leftSoft = "Ouvrir";
          rightSoft = "Quitter";
          content += "   > MENU PRINCIPAL\n\n";
          menuItems.forEach((item, idx) => {
            const prefix = idx === state.menuIndex ? " > " : "   ";
            content += prefix + item + "\n";
          });
          break;

        case "messages":
          leftSoft = "Ouvrir";
          rightSoft = "Retour";
          content += "   > MESSAGES (LIGNE TEMPS)\n\n";
          messages.forEach((msg, idx) => {
            const prefix = idx === state.messageIndex ? " > " : "   ";
            const label = (msg.era + " ".repeat(10)).slice(0, 10);
            content += `${prefix}${label} ${msg.time}\n`;
          });
          break;

        case "msgView": {
          leftSoft = "Retour";
          rightSoft = "";
          const msg = messages[state.messageIndex];
          content += `   De : ${msg.from}\n`;
          content += `   √àre : ${msg.era}\n`;
          content += `   Heure : ${msg.time}\n\n`;
          msg.text.forEach(line => {
            content += "   " + line + "\n";
          });
          break;
        }

        case "contacts":
          leftSoft = "Voir";
          rightSoft = "Retour";
          content += "   > CONTACTS\n\n";
          contacts.forEach((c, idx) => {
            const prefix = idx === state.contactIndex ? " > " : "   ";
            let name = (c.name + " ".repeat(14)).slice(0, 14);
            content += `${prefix}${name} ${c.era}\n`;
          });
          break;

        case "contactView": {
          leftSoft = "Appeler";
          rightSoft = "Retour";
          const c = contacts[state.contactIndex];
          content += `   Nom : ${c.name}\n`;
          content += `   √àre : ${c.era}\n\n`;
          c.note.forEach(line => {
            content += "   " + line + "\n";
          });
          break;
        }

        case "calls":
          leftSoft = "D√©tails";
          rightSoft = "Retour";
          content += "   > JOURNAL D'APPELS\n\n";
          calls.forEach((call, idx) => {
            const prefix = idx === state.callIndex ? " > " : "   ";
            let who = (call.with + " ".repeat(10)).slice(0, 10);
            content += `${prefix}${call.dir[0]}/${call.time} ${who} ${call.era}\n`;
          });
          break;

        case "callView": {
          leftSoft = "Retour";
          rightSoft = "";
          const call = calls[state.callIndex];
          content += `   Avec : ${call.with}\n`;
          content += `   √àre  : ${call.era}\n`;
          content += `   Sens : ${call.dir}\n`;
          content += `   Heure: ${call.time}\n\n`;
          call.summary.forEach(l => {
            content += "   " + l + "\n";
          });
          break;
        }

        case "archives":
          leftSoft = "Ouvrir";
          rightSoft = "Retour";
          content += "   > ARCHIVES R√âSEAU\n\n";
          archives.forEach((a, idx) => {
            const prefix = idx === state.archiveIndex ? " > " : "   ";
            let title = (a.title + " ".repeat(16)).slice(0, 16);
            content += `${prefix}${title} ${a.era}\n`;
          });
          break;

        case "archiveView": {
          leftSoft = "Retour";
          rightSoft = "";
          const a = archives[state.archiveIndex];
          content += `   ${a.title}\n`;
          content += `   ${a.era}\n\n`;
          a.lines.forEach(l => {
            content += "   " + l + "\n";
          });
          break;
        }

        case "futures": {
          leftSoft = "Choisir";
          rightSoft = "Retour";
          const f = futures[state.futureNode || "start"];
          content += `   ${f.title}\n\n`;
          f.lines.forEach(l => {
            content += "   " + l + "\n";
          });
          content += "\n";
          f.choices.forEach(ch => {
            content += "   " + ch.label + "\n";
          });
          break;
        }

        case "dystopia":
          leftSoft = "Retour";
          rightSoft = "";
          content += "   DYSTOPIE DOUCE\n\n";
          content += "   Plus les appareils sont\n";
          content += "   ¬´ intelligents ¬ª, plus ils\n";
          content += "   parlent entre eux.\n\n";
          content += "   Ce t√©l√©phone ne parle qu'√†\n";
          content += "   toi. Il ne sait pas\n";
          content += "   uploader ta vie.";
          break;

        case "offline":
          leftSoft = "OK";
          rightSoft = "";
          content += "   MODE ULTRA OFFLINE\n\n";
          content += "   - aucune 4G/5G\n";
          content += "   - aucun compte cloud\n";
          content += "   - pas de pub cibl√©e\n\n";
          content += "   Tout ce que tu vois est\n";
          content += "   dans ce fichier HTML.\n\n";
          content += "   Rien √† vendre ici.";
          break;

        case "about":
          leftSoft = "Retour";
          rightSoft = "";
          content += "   REGLAGES SOBRES\n\n";
          content += "   Sonnerie : simple bip\n";
          content += "   Historique : local seul\n";
          content += "   Synchronisation : jamais\n\n";
          content += "   Astuce : le vrai bouton\n";
          content += "   \"mode avion\" est le\n";
          content += "   bouton d'alimentation.";
          break;

        default:
          content += "   ERREUR D'√âCRAN.\n";
          content += "   Retour √† l'accueil.\n";
          state.screen = "idle";
          break;
      }

      screenContentEl.textContent = content;

      softLeftEl.textContent = leftSoft;
      softRightEl.textContent = rightSoft;

      // Curseur clignotant en bas
      const cursorSpan = document.createElement("span");
      cursorSpan.className = "cursor";
      screenContentEl.appendChild(cursorSpan);
    }

    renderScreen();

    // ---------- NAVIGATION ----------

    function goIdle() {
      state.screen = "idle";
      renderScreen();
    }

    function openMenu() {
      state.screen = "menu";
      state.menuIndex = 0;
      renderScreen();
    }

    function openMessages() {
      state.screen = "messages";
      state.messageIndex = 0;
      renderScreen();
    }

    function openContacts() {
      state.screen = "contacts";
      state.contactIndex = 0;
      renderScreen();
    }

    function openCalls() {
      state.screen = "calls";
      state.callIndex = 0;
      renderScreen();
    }

    function openArchives() {
      state.screen = "archives";
      state.archiveIndex = 0;
      renderScreen();
    }

    function openFutures() {
      state.screen = "futures";
      state.futureNode = "start";
      renderScreen();
    }

    function handleFutureChoice(keyChar) {
      const f = futures[state.futureNode || "start"];
      if (!f) return;
      const choice = f.choices.find(ch => ch.label.trim().startsWith(keyChar));
      if (!choice) return;
      state.futureNode = choice.next;
      state.screen = "futures";
      renderScreen();
    }

    function handleOK() {
      switch (state.screen) {
        case "idle":
          openMenu();
          break;

        case "menu": {
          const item = menuItems[state.menuIndex];
          if (item.startsWith("Messages")) openMessages();
          else if (item === "Contacts") openContacts();
          else if (item.startsWith("Journal")) openCalls();
          else if (item === "Archives") openArchives();
          else if (item === "Futurs possibles") openFutures();
          else if (item === "R√©glages sobres") {
            state.screen = "about";
            renderScreen();
          } else if (item === "Dystopie ?") {
            state.screen = "dystopia";
            renderScreen();
          }
          break;
        }

        case "messages":
          state.screen = "msgView";
          renderScreen();
          break;

        case "contacts":
          state.screen = "contactView";
          renderScreen();
          break;

        case "calls":
          state.screen = "callView";
          renderScreen();
          break;

        case "archives":
          state.screen = "archiveView";
          renderScreen();
          break;

        case "contactView":
          // lancer un "appel" symbolique vers ce contact
          state.screen = "callView";
          state.callIndex = Math.min(state.contactIndex, calls.length - 1);
          renderScreen();
          break;

        case "offline":
          goIdle();
          break;

        case "futures": {
          // OK = prendre automatiquement le premier choix
          const f = futures[state.futureNode || "start"];
          if (f && f.choices[0]) {
            state.futureNode = f.choices[0].next;
            state.screen = "futures";
            renderScreen();
          }
          break;
        }

        case "dystopia":
        case "about":
        case "msgView":
        case "callView":
        case "archiveView":
          // pas d'action sp√©ciale
          break;

        default:
          goIdle();
      }
    }

    function handleBack() {
      switch (state.screen) {
        case "menu":
        case "offline":
          goIdle();
          break;

        case "messages":
          openMenu();
          break;

        case "msgView":
          state.screen = "messages";
          renderScreen();
          break;

        case "contacts":
          openMenu();
          break;

        case "contactView":
          state.screen = "contacts";
          renderScreen();
          break;

        case "calls":
          openMenu();
          break;

        case "callView":
          state.screen = "calls";
          renderScreen();
          break;

        case "archives":
          openMenu();
          break;

        case "archiveView":
          state.screen = "archives";
          renderScreen();
          break;

        case "futures":
          // retour = retour au menu principal
          openMenu();
          break;

        case "dystopia":
        case "about":
          openMenu();
          break;

        default:
          goIdle();
      }
    }

    function moveSelection(delta) {
      if (state.screen === "menu") {
        const len = menuItems.length;
        state.menuIndex = (state.menuIndex + delta + len) % len;
      } else if (state.screen === "messages") {
        const len = messages.length;
        state.messageIndex = (state.messageIndex + delta + len) % len;
      } else if (state.screen === "contacts") {
        const len = contacts.length;
        state.contactIndex = (state.contactIndex + delta + len) % len;
      } else if (state.screen === "calls") {
        const len = calls.length;
        state.callIndex = (state.callIndex + delta + len) % len;
      } else if (state.screen === "archives") {
        const len = archives.length;
        state.archiveIndex = (state.archiveIndex + delta + len) % len;
      }
      renderScreen();
    }

    // ---------- CLAVIER VIRTUEL ----------

    function handleKeypadClick(e) {
      const el = e.currentTarget;
      const action = el.getAttribute("data-action");
      const key = el.getAttribute("data-key");

      if (action) {
        if (action === "up") moveSelection(-1);
        else if (action === "call") {
          // depuis accueil : ouvre journal d'appels
          if (state.screen === "idle") openCalls();
          else handleOK();
        }
        else if (action === "end") {
          goIdle();
        }
        else if (action === "offline") {
          state.screen = "offline";
          renderScreen();
        }
        return;
      }

      if (!key) return;

      // Gestion sp√©cifique de l'arbre des futurs
      if (state.screen === "futures") {
        if (key >= "0" && key <= "5") {
          handleFutureChoice(key);
          return;
        }
      }

      if (key === "5") {
        handleOK();
      } else if (key === "0") {
        handleBack();
      } else if (key === "2") {
        moveSelection(-1);
      } else if (key === "8") {
        moveSelection(1);
      } else if (key === "*") {
        openArchives();
      } else if (key === "#") {
        state.screen = "dystopia";
        renderScreen();
      }
    }

    document.querySelectorAll(".key").forEach((el) => {
      el.addEventListener("click", handleKeypadClick);
    });

    // ---------- SOFTKEYS ----------

    softLeftEl.addEventListener("click", () => {
      if (state.screen === "idle") openMenu();
      else handleOK();
    });

    softRightEl.addEventListener("click", () => {
      if (state.screen === "idle") {
        openContacts();
      } else {
        handleBack();
      }
    });

    // ---------- CLAVIER PHYSIQUE ----------

    document.addEventListener("keydown", (e) => {
      const k = e.key;

      // Gestion futures d'abord
      if (state.screen === "futures" && k >= "0" && k <= "5") {
        handleFutureChoice(k);
        return;
      }

      if (k === "ArrowUp") {
        moveSelection(-1);
      } else if (k === "ArrowDown") {
        moveSelection(1);
      } else if (k === "Enter") {
        handleOK();
      } else if (k === "Escape" || k === "Backspace" || k === "0") {
        handleBack();
      } else if (k === "5") {
        handleOK();
      } else if (k === "2") {
        moveSelection(-1);
      } else if (k === "8") {
        moveSelection(1);
      } else if (k === "*") {
        openArchives();
      } else if (k === "#") {
        state.screen = "dystopia";
        renderScreen();
      }
    });
  </script>
</body>
</html>
